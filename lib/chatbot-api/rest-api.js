"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ApiResolvers = void 0;
const path = require("path");
const cdk = require("aws-cdk-lib");
const constructs_1 = require("constructs");
const ec2 = require("aws-cdk-lib/aws-ec2");
const iam = require("aws-cdk-lib/aws-iam");
const lambda = require("aws-cdk-lib/aws-lambda");
const logs = require("aws-cdk-lib/aws-logs");
const graphql_1 = require("graphql");
const fs_1 = require("fs");
class ApiResolvers extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        const apiSecurityGroup = new ec2.SecurityGroup(this, "ApiSecurityGroup", {
            vpc: props.shared.vpc,
        });
        const appSyncLambdaResolver = new lambda.Function(this, "GraphQLApiHandler", {
            code: props.shared.sharedCode.bundleWithLambdaAsset(path.join(__dirname, "./functions/api-handler")),
            handler: "index.handler",
            runtime: props.shared.pythonRuntime,
            architecture: props.shared.lambdaArchitecture,
            timeout: cdk.Duration.minutes(10),
            memorySize: 512,
            tracing: lambda.Tracing.ACTIVE,
            logRetention: logs.RetentionDays.ONE_WEEK,
            layers: [props.shared.powerToolsLayer, props.shared.commonLayer],
            vpc: props.shared.vpc,
            securityGroups: [apiSecurityGroup],
            vpcSubnets: props.shared.vpc.privateSubnets,
            environment: {
                ...props.shared.defaultEnvironmentVariables,
                CONFIG_PARAMETER_NAME: props.shared.configParameter.parameterName,
                MODELS_PARAMETER_NAME: props.modelsParameter.parameterName,
                X_ORIGIN_VERIFY_SECRET_ARN: props.shared.xOriginVerifySecret.secretArn,
                API_KEYS_SECRETS_ARN: props.shared.apiKeysSecret.secretArn,
                SESSIONS_TABLE_NAME: props.sessionsTable.tableName,
                QUESTIONS_TABLE_NAME: props.questionsTable.tableName,
                QUESTIONS_BY_SESSION_INDEX_NAME: props.bySessionIdIndex,
                USER_FEEDBACK_BUCKET_NAME: props.userFeedbackBucket?.bucketName ?? "",
                CHATBOT_FILES_BUCKET_NAME: props.filesBucket.bucketName,
                UPLOAD_BUCKET_NAME: props.ragEngines?.uploadBucket?.bucketName ?? "",
                PROCESSING_BUCKET_NAME: props.ragEngines?.processingBucket?.bucketName ?? "",
                AURORA_DB_SECRET_ID: props.ragEngines?.auroraPgVector?.database
                    ?.secret?.secretArn,
                WORKSPACES_TABLE_NAME: props.ragEngines?.workspacesTable.tableName ?? "",
                WORKSPACES_BY_OBJECT_TYPE_INDEX_NAME: props.ragEngines?.workspacesByObjectTypeIndexName ?? "",
                DOCUMENTS_TABLE_NAME: props.ragEngines?.documentsTable.tableName ?? "",
                DOCUMENTS_BY_COMPOUND_KEY_INDEX_NAME: props.ragEngines?.documentsByCompountKeyIndexName ?? "",
                DOCUMENTS_BY_STATUS_INDEX: props.ragEngines?.documentsByStatusIndexName ?? "",
                SAGEMAKER_RAG_MODELS_ENDPOINT: props.ragEngines?.sageMakerRagModels?.model.endpoint
                    ?.attrEndpointName ?? "",
                DELETE_WORKSPACE_WORKFLOW_ARN: props.ragEngines?.deleteWorkspaceWorkflow?.stateMachineArn ?? "",
                CREATE_AURORA_WORKSPACE_WORKFLOW_ARN: props.ragEngines?.auroraPgVector?.createAuroraWorkspaceWorkflow
                    ?.stateMachineArn ?? "",
                CREATE_OPEN_SEARCH_WORKSPACE_WORKFLOW_ARN: props.ragEngines?.openSearchVector
                    ?.createOpenSearchWorkspaceWorkflow?.stateMachineArn ?? "",
                CREATE_KENDRA_WORKSPACE_WORKFLOW_ARN: props.ragEngines?.kendraRetrieval?.createKendraWorkspaceWorkflow
                    ?.stateMachineArn ?? "",
                FILE_IMPORT_WORKFLOW_ARN: props.ragEngines?.fileImportWorkflow?.stateMachineArn ?? "",
                WEBSITE_CRAWLING_WORKFLOW_ARN: props.ragEngines?.websiteCrawlingWorkflow?.stateMachineArn ?? "",
                OPEN_SEARCH_COLLECTION_ENDPOINT: props.ragEngines?.openSearchVector?.openSearchCollectionEndpoint ??
                    "",
                DEFAULT_KENDRA_INDEX_ID: props.ragEngines?.kendraRetrieval?.kendraIndex?.attrId ?? "",
                DEFAULT_KENDRA_INDEX_NAME: props.ragEngines?.kendraRetrieval?.kendraIndex?.name ?? "",
                DEFAULT_KENDRA_S3_DATA_SOURCE_ID: props.ragEngines?.kendraRetrieval?.kendraS3DataSource?.attrId ?? "",
                DEFAULT_KENDRA_S3_DATA_SOURCE_BUCKET_NAME: props.ragEngines?.kendraRetrieval?.kendraS3DataSourceBucket
                    ?.bucketName ?? "",
                RSS_FEED_INGESTOR_FUNCTION: props.ragEngines?.dataImport.rssIngestorFunction?.functionArn ?? "",
            },
        });
        function addPermissions(apiHandler) {
            if (props.ragEngines?.workspacesTable) {
                props.ragEngines.workspacesTable.grantReadWriteData(apiHandler);
            }
            if (props.ragEngines?.documentsTable) {
                props.ragEngines.documentsTable.grantReadWriteData(apiHandler);
                props.ragEngines?.dataImport.rssIngestorFunction?.grantInvoke(apiHandler);
            }
            if (props.ragEngines?.auroraPgVector) {
                props.ragEngines.auroraPgVector.database.secret?.grantRead(apiHandler);
                props.ragEngines.auroraPgVector.database.connections.allowDefaultPortFrom(apiHandler);
                props.ragEngines.auroraPgVector.createAuroraWorkspaceWorkflow.grantStartExecution(apiHandler);
            }
            if (props.ragEngines?.openSearchVector) {
                apiHandler.addToRolePolicy(new iam.PolicyStatement({
                    actions: ["aoss:APIAccessAll"],
                    resources: [
                        props.ragEngines?.openSearchVector.openSearchCollection.attrArn,
                    ],
                }));
                props.ragEngines.openSearchVector.createOpenSearchWorkspaceWorkflow.grantStartExecution(apiHandler);
            }
            if (props.ragEngines?.kendraRetrieval) {
                props.ragEngines.kendraRetrieval.createKendraWorkspaceWorkflow.grantStartExecution(apiHandler);
                props.ragEngines?.kendraRetrieval?.kendraS3DataSourceBucket?.grantReadWrite(apiHandler);
                if (props.ragEngines.kendraRetrieval.kendraIndex) {
                    apiHandler.addToRolePolicy(new iam.PolicyStatement({
                        actions: [
                            "kendra:Retrieve",
                            "kendra:Query",
                            "kendra:BatchDeleteDocument",
                            "kendra:BatchPutDocument",
                            "kendra:StartDataSourceSyncJob",
                            "kendra:DescribeDataSourceSyncJob",
                            "kendra:StopDataSourceSyncJob",
                            "kendra:ListDataSourceSyncJobs",
                            "kendra:ListDataSources",
                            "kendra:DescribeIndex",
                        ],
                        resources: [
                            props.ragEngines.kendraRetrieval.kendraIndex.attrArn,
                            `${props.ragEngines.kendraRetrieval.kendraIndex.attrArn}/*`,
                        ],
                    }));
                }
                for (const item of props.config.rag.engines.kendra.external ?? []) {
                    if (item.roleArn) {
                        apiHandler.addToRolePolicy(new iam.PolicyStatement({
                            actions: ["sts:AssumeRole"],
                            resources: [item.roleArn],
                        }));
                    }
                    else {
                        apiHandler.addToRolePolicy(new iam.PolicyStatement({
                            actions: ["kendra:Retrieve", "kendra:Query"],
                            resources: [
                                `arn:${cdk.Aws.PARTITION}:kendra:${item.region ?? cdk.Aws.REGION}:${cdk.Aws.ACCOUNT_ID}:index/${item.kendraId}`,
                            ],
                        }));
                    }
                }
            }
            if (props.ragEngines?.fileImportWorkflow) {
                props.ragEngines.fileImportWorkflow.grantStartExecution(apiHandler);
            }
            if (props.ragEngines?.websiteCrawlingWorkflow) {
                props.ragEngines.websiteCrawlingWorkflow.grantStartExecution(apiHandler);
            }
            if (props.ragEngines?.deleteWorkspaceWorkflow) {
                props.ragEngines.deleteWorkspaceWorkflow.grantStartExecution(apiHandler);
            }
            if (props.ragEngines?.sageMakerRagModels) {
                apiHandler.addToRolePolicy(new iam.PolicyStatement({
                    actions: ["sagemaker:InvokeEndpoint"],
                    resources: [props.ragEngines.sageMakerRagModels.model.endpoint.ref],
                }));
            }
            for (const model of props.models) {
                apiHandler.addToRolePolicy(new iam.PolicyStatement({
                    actions: ["sagemaker:InvokeEndpoint"],
                    resources: [model.endpoint.ref],
                }));
            }
            apiHandler.addToRolePolicy(new iam.PolicyStatement({
                actions: [
                    "comprehend:DetectDominantLanguage",
                    "comprehend:DetectSentiment",
                ],
                resources: ["*"],
            }));
            props.shared.xOriginVerifySecret.grantRead(apiHandler);
            props.shared.apiKeysSecret.grantRead(apiHandler);
            props.shared.configParameter.grantRead(apiHandler);
            props.modelsParameter.grantRead(apiHandler);
            props.sessionsTable.grantReadWriteData(apiHandler);
            props.questionsTable.grantReadWriteData(apiHandler);
            props.filesBucket.grantReadWrite(apiHandler);
            props.userFeedbackBucket.grantReadWrite(apiHandler);
            props.ragEngines?.uploadBucket.grantReadWrite(apiHandler);
            props.ragEngines?.processingBucket.grantReadWrite(apiHandler);
            if (props.config.bedrock?.enabled) {
                apiHandler.addToRolePolicy(new iam.PolicyStatement({
                    actions: [
                        "bedrock:ListFoundationModels",
                        "bedrock:ListCustomModels",
                        "bedrock:InvokeModel",
                        "bedrock:InvokeModelWithResponseStream",
                    ],
                    resources: ["*"],
                }));
                if (props.config.bedrock?.roleArn) {
                    apiHandler.addToRolePolicy(new iam.PolicyStatement({
                        actions: ["sts:AssumeRole"],
                        resources: [props.config.bedrock.roleArn],
                    }));
                }
            }
        }
        addPermissions(appSyncLambdaResolver);
        props.ragEngines?.openSearchVector?.addToAccessPolicy("graphql-api", [appSyncLambdaResolver.role?.roleArn], ["aoss:DescribeIndex", "aoss:ReadDocument", "aoss:WriteDocument"]);
        const functionDataSource = props.api.addLambdaDataSource("proxyResolverFunction", appSyncLambdaResolver);
        const schema = graphql_1.parse(fs_1.readFileSync("lib/chatbot-api/schema/schema.graphql", "utf8"));
        function addResolvers(operationType) {
            const fieldNames = schema.definitions
                .filter((x) => x.kind == "ObjectTypeDefinition")
                .filter((y) => y.name.value == operationType)[0].fields.map((z) => z.name.value);
            for (const fieldName of fieldNames) {
                // These resolvers are added by the Realtime API
                if (fieldName == "sendQuery" || fieldName == "publishResponse") {
                    continue;
                }
                props.api.createResolver(`${fieldName}-resolver`, {
                    typeName: operationType,
                    fieldName: fieldName,
                    dataSource: functionDataSource,
                });
            }
        }
        addResolvers("Query");
        addResolvers("Mutation");
    }
}
exports.ApiResolvers = ApiResolvers;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzdC1hcGkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJyZXN0LWFwaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSw2QkFBNkI7QUFDN0IsbUNBQW1DO0FBRW5DLDJDQUF1QztBQUl2QywyQ0FBMkM7QUFDM0MsMkNBQTJDO0FBQzNDLGlEQUFpRDtBQUNqRCw2Q0FBNkM7QUFJN0MscUNBQWdDO0FBQ2hDLDJCQUFrQztBQWtCbEMsTUFBYSxZQUFhLFNBQVEsc0JBQVM7SUFDekMsWUFBWSxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUF3QjtRQUNoRSxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRWpCLE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxHQUFHLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxrQkFBa0IsRUFBRTtZQUN2RSxHQUFHLEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHO1NBQ3RCLENBQUMsQ0FBQztRQUVILE1BQU0scUJBQXFCLEdBQUcsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUMvQyxJQUFJLEVBQ0osbUJBQW1CLEVBQ25CO1lBQ0UsSUFBSSxFQUFFLEtBQUssQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLHFCQUFxQixDQUNqRCxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSx5QkFBeUIsQ0FBQyxDQUNoRDtZQUNELE9BQU8sRUFBRSxlQUFlO1lBQ3hCLE9BQU8sRUFBRSxLQUFLLENBQUMsTUFBTSxDQUFDLGFBQWE7WUFDbkMsWUFBWSxFQUFFLEtBQUssQ0FBQyxNQUFNLENBQUMsa0JBQWtCO1lBQzdDLE9BQU8sRUFBRSxHQUFHLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFDakMsVUFBVSxFQUFFLEdBQUc7WUFDZixPQUFPLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNO1lBQzlCLFlBQVksRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVE7WUFDekMsTUFB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b0JBQ2hELFFBQVEsRUFBRSxhQUFhO29CQUN2QixTQUFTLEVBQUUsU0FBUztvQkFDcEIsVUFBVSxFQUFFLGtCQUFrQjtpQkFDL0IsQ0FBQyxDQUFDO2FBQ0o7UUFDSCxDQUFDO1FBRUQsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3RCLFlBQVksQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUMzQixDQUFDO0NBQ0Y7QUE3U0Qsb0NBNlNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgcGF0aCBmcm9tIFwicGF0aFwiO1xuaW1wb3J0ICogYXMgY2RrIGZyb20gXCJhd3MtY2RrLWxpYlwiO1xuaW1wb3J0IHsgU2FnZU1ha2VyTW9kZWxFbmRwb2ludCwgU3lzdGVtQ29uZmlnIH0gZnJvbSBcIi4uL3NoYXJlZC90eXBlc1wiO1xuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSBcImNvbnN0cnVjdHNcIjtcbmltcG9ydCB7IFJhZ0VuZ2luZXMgfSBmcm9tIFwiLi4vcmFnLWVuZ2luZXNcIjtcbmltcG9ydCAqIGFzIGNvZ25pdG8gZnJvbSBcImF3cy1jZGstbGliL2F3cy1jb2duaXRvXCI7XG5pbXBvcnQgKiBhcyBkeW5hbW9kYiBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWR5bmFtb2RiXCI7XG5pbXBvcnQgKiBhcyBlYzIgZnJvbSBcImF3cy1jZGstbGliL2F3cy1lYzJcIjtcbmltcG9ydCAqIGFzIGlhbSBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWlhbVwiO1xuaW1wb3J0ICogYXMgbGFtYmRhIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtbGFtYmRhXCI7XG5pbXBvcnQgKiBhcyBsb2dzIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtbG9nc1wiO1xuaW1wb3J0ICogYXMgc3NtIGZyb20gXCJhd3MtY2RrLWxpYi9hd3Mtc3NtXCI7XG5pbXBvcnQgeyBTaGFyZWQgfSBmcm9tIFwiLi4vc2hhcmVkXCI7XG5pbXBvcnQgKiBhcyBhcHBzeW5jIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtYXBwc3luY1wiO1xuaW1wb3J0IHsgcGFyc2UgfSBmcm9tIFwiZ3JhcGhxbFwiO1xuaW1wb3J0IHsgcmVhZEZpbGVTeW5jIH0gZnJvbSBcImZzXCI7XG5pbXBvcnQgKiBhcyBzMyBmcm9tIFwiYXdzLWNkay1saWIvYXdzLXMzXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXBpUmVzb2x2ZXJzUHJvcHMge1xuICByZWFkb25seSBzaGFyZWQ6IFNoYXJlZDtcbiAgcmVhZG9ubHkgY29uZmlnOiBTeXN0ZW1Db25maWc7XG4gIHJlYWRvbmx5IHJhZ0VuZ2luZXM/OiBSYWdFbmdpbmVzO1xuICByZWFkb25seSB1c2VyUG9vbDogY29nbml0by5Vc2VyUG9vbDtcbiAgcmVhZG9ubHkgc2Vzc2lvbnNUYWJsZTogZHluYW1vZGIuVGFibGU7XG4gIHJlYWRvbmx5IHF1ZXN0aW9uc1RhYmxlOiBkeW5hbW9kYi5UYWJsZTtcbiAgcmVhZG9ubHkgYnlTZXNzaW9uSWRJbmRleDogc3RyaW5nO1xuICByZWFkb25seSB1c2VyRmVlZGJhY2tCdWNrZXQ6IHMzLkJ1Y2tldDtcbiAgcmVhZG9ubHkgbW9kZWxzUGFyYW1ldGVyOiBzc20uU3RyaW5nUGFyYW1ldGVyO1xuICByZWFkb25seSBtb2RlbHM6IFNhZ2VNYWtlck1vZGVsRW5kcG9pbnRbXTtcbiAgcmVhZG9ubHkgYXBpOiBhcHBzeW5jLkdyYXBocWxBcGk7XG4gIHJlYWRvbmx5IGZpbGVzQnVja2V0OiBzMy5CdWNrZXQ7XG59XG5cbmV4cG9ydCBjbGFzcyBBcGlSZXNvbHZlcnMgZXh0ZW5kcyBDb25zdHJ1Y3Qge1xuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogQXBpUmVzb2x2ZXJzUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuXG4gICAgY29uc3QgYXBpU2VjdXJpdHlHcm91cCA9IG5ldyBlYzIuU2VjdXJpdHlHcm91cCh0aGlzLCBcIkFwaVNlY3VyaXR5R3JvdXBcIiwge1xuICAgICAgdnBjOiBwcm9wcy5zaGFyZWQudnBjLFxuICAgIH0pO1xuXG4gICAgY29uc3QgYXBwU3luY0xhbWJkYVJlc29sdmVyID0gbmV3IGxhbWJkYS5GdW5jdGlvbihcbiAgICAgIHRoaXMsXG4gICAgICBcIkdyYXBoUUxBcGlIYW5kbGVyXCIsXG4gICAgICB7XG4gICAgICAgIGNvZGU6IHByb3BzLnNoYXJlZC5zaGFyZWRDb2RlLmJ1bmRsZVdpdGhMYW1iZGFBc3NldChcbiAgICAgICAgICBwYXRoLmpvaW4oX19kaXJuYW1lLCBcIi4vZnVuY3Rpb25zL2FwaS1oYW5kbGVyXCIpXG4gICAgICAgICksXG4gICAgICAgIGhhbmRsZXI6IFwiaW5kZXguaGFuZGxlclwiLFxuICAgICAgICBydW50aW1lOiBwcm9wcy5zaGFyZWQucHl0aG9uUnVudGltZSxcbiAgICAgICAgYXJjaGl0ZWN0dXJlOiBwcm9wcy5zaGFyZWQubGFtYmRhQXJjaGl0ZWN0dXJlLFxuICAgICAgICB0aW1lb3V0OiBjZGsuRHVyYXRpb24ubWludXRlcygxMCksXG4gICAgICAgIG1lbW9yeVNpemU6IDUxMixcbiAgICAgICAgdHJhY2luZzogbGFtYmRhLlRyYWNpbmcuQUNUSVZFLFxuICAgICAgICBsb2dSZXRlbnRpb246IGxvZ3MuUmV0ZW50aW9uRGF5cy5PTkVfV0VFSyxcbiAgICAgICAgbGF5ZXJzOiBbcHJvcHMuc2hhcmVkLnBvd2VyVG9vbHNMYXllciwgcHJvcHMuc2hhcmVkLmNvbW1vbkxheWVyXSxcbiAgICAgICAgdnBjOiBwcm9wcy5zaGFyZWQudnBjLFxuICAgICAgICBzZWN1cml0eUdyb3VwczogW2FwaVNlY3VyaXR5R3JvdXBdLFxuICAgICAgICB2cGNTdWJuZXRzOiBwcm9wcy5zaGFyZWQudnBjLnByaXZhdGVTdWJuZXRzIGFzIGVjMi5TdWJuZXRTZWxlY3Rpb24sXG4gICAgICAgIGVudmlyb25tZW50OiB7XG4gICAgICAgICAgLi4ucHJvcHMuc2hhcmVkLmRlZmF1bHRFbnZpcm9ubWVudFZhcmlhYmxlcyxcbiAgICAgICAgICBDT05GSUdfUEFSQU1FVEVSX05BTUU6IHByb3BzLnNoYXJlZC5jb25maWdQYXJhbWV0ZXIucGFyYW1ldGVyTmFtZSxcbiAgICAgICAgICBNT0RFTFNfUEFSQU1FVEVSX05BTUU6IHByb3BzLm1vZGVsc1BhcmFtZXRlci5wYXJhbWV0ZXJOYW1lLFxuICAgICAgICAgIFhfT1JJR0lOX1ZFUklGWV9TRUNSRVRfQVJOOlxuICAgICAgICAgICAgcHJvcHMuc2hhcmVkLnhPcmlnaW5WZXJpZnlTZWNyZXQuc2VjcmV0QXJuLFxuICAgICAgICAgIEFQSV9LRVlTX1NFQ1JFVFNfQVJOOiBwcm9wcy5zaGFyZWQuYXBpS2V5c1NlY3JldC5zZWNyZXRBcm4sXG4gICAgICAgICAgU0VTU0lPTlNfVEFCTEVfTkFNRTogcHJvcHMuc2Vzc2lvbnNUYWJsZS50YWJsZU5hbWUsXG4gICAgICAgICAgUVVFU1RJT05TX1RBQkxFX05BTUU6IHByb3BzLnF1ZXN0aW9uc1RhYmxlLnRhYmxlTmFtZSxcbiAgICAgICAgICBRVUVTVElPTlNfQllfU0VTU0lPTl9JTkRFWF9OQU1FOiBwcm9wcy5ieVNlc3Npb25JZEluZGV4LFxuICAgICAgICAgIFVTRVJfRkVFREJBQ0tfQlVDS0VUX05BTUU6IHByb3BzLnVzZXJGZWVkYmFja0J1Y2tldD8uYnVja2V0TmFtZSA/PyBcIlwiLFxuICAgICAgICAgIENIQVRCT1RfRklMRVNfQlVDS0VUX05BTUU6IHByb3BzLmZpbGVzQnVja2V0LmJ1Y2tldE5hbWUsXG4gICAgICAgICAgVVBMT0FEX0JVQ0tFVF9OQU1FOiBwcm9wcy5yYWdFbmdpbmVzPy51cGxvYWRCdWNrZXQ/LmJ1Y2tldE5hbWUgPz8gXCJcIixcbiAgICAgICAgICBQUk9DRVNTSU5HX0JVQ0tFVF9OQU1FOlxuICAgICAgICAgICAgcHJvcHMucmFnRW5naW5lcz8ucHJvY2Vzc2luZ0J1Y2tldD8uYnVja2V0TmFtZSA/PyBcIlwiLFxuICAgICAgICAgIEFVUk9SQV9EQl9TRUNSRVRfSUQ6IHByb3BzLnJhZ0VuZ2luZXM/LmF1cm9yYVBnVmVjdG9yPy5kYXRhYmFzZVxuICAgICAgICAgICAgPy5zZWNyZXQ/LnNlY3JldEFybiBhcyBzdHJpbmcsXG4gICAgICAgICAgV09SS1NQQUNFU19UQUJMRV9OQU1FOlxuICAgICAgICAgICAgcHJvcHMucmFnRW5naW5lcz8ud29ya3NwYWNlc1RhYmxlLnRhYmxlTmFtZSA/PyBcIlwiLFxuICAgICAgICAgIFdPUktTUEFDRVNfQllfT0JKRUNUX1RZUEVfSU5ERVhfTkFNRTpcbiAgICAgICAgICAgIHByb3BzLnJhZ0VuZ2luZXM/LndvcmtzcGFjZXNCeU9iamVjdFR5cGVJbmRleE5hbWUgPz8gXCJcIixcbiAgICAgICAgICBET0NVTUVOVFNfVEFCTEVfTkFNRTpcbiAgICAgICAgICAgIHByb3BzLnJhZ0VuZ2luZXM/LmRvY3VtZW50c1RhYmxlLnRhYmxlTmFtZSA/PyBcIlwiLFxuICAgICAgICAgIERPQ1VNRU5UU19CWV9DT01QT1VORF9LRVlfSU5ERVhfTkFNRTpcbiAgICAgICAgICAgIHByb3BzLnJhZ0VuZ2luZXM/LmRvY3VtZW50c0J5Q29tcG91bnRLZXlJbmRleE5hbWUgPz8gXCJcIixcbiAgICAgICAgICBET0NVTUVOVFNfQllfU1RBVFVTX0lOREVYOlxuICAgICAgICAgICAgcHJvcHMucmFnRW5naW5lcz8uZG9jdW1lbnRzQnlTdGF0dXNJbmRleE5hbWUgPz8gXCJcIixcbiAgICAgICAgICBTQUdFTUFLRVJfUkFHX01PREVMU19FTkRQT0lOVDpcbiAgICAgICAgICAgIHByb3BzLnJhZ0VuZ2luZXM/LnNhZ2VNYWtlclJhZ01vZGVscz8ubW9kZWwuZW5kcG9pbnRcbiAgICAgICAgICAgICAgPy5hdHRyRW5kcG9pbnROYW1lID8/IFwiXCIsXG4gICAgICAgICAgREVMRVRFX1dPUktTUEFDRV9XT1JLRkxPV19BUk46XG4gICAgICAgICAgICBwcm9wcy5yYWdFbmdpbmVzPy5kZWxldGVXb3Jrc3BhY2VXb3JrZmxvdz8uc3RhdGVNYWNoaW5lQXJuID8/IFwiXCIsXG4gICAgICAgICAgQ1JFQVRFX0FVUk9SQV9XT1JLU1BBQ0VfV09SS0ZMT1dfQVJOOlxuICAgICAgICAgICAgcHJvcHMucmFnRW5naW5lcz8uYXVyb3JhUGdWZWN0b3I/LmNyZWF0ZUF1cm9yYVdvcmtzcGFjZVdvcmtmbG93XG4gICAgICAgICAgICAgID8uc3RhdGVNYWNoaW5lQXJuID8/IFwiXCIsXG4gICAgICAgICAgQ1JFQVRFX09QRU5fU0VBUkNIX1dPUktTUEFDRV9XT1JLRkxPV19BUk46XG4gICAgICAgICAgICBwcm9wcy5yYWdFbmdpbmVzPy5vcGVuU2VhcmNoVmVjdG9yXG4gICAgICAgICAgICAgID8uY3JlYXRlT3BlblNlYXJjaFdvcmtzcGFjZVdvcmtmbG93Py5zdGF0ZU1hY2hpbmVBcm4gPz8gXCJcIixcbiAgICAgICAgICBDUkVBVEVfS0VORFJBX1dPUktTUEFDRV9XT1JLRkxPV19BUk46XG4gICAgICAgICAgICBwcm9wcy5yYWdFbmdpbmVzPy5rZW5kcmFSZXRyaWV2YWw/LmNyZWF0ZUtlbmRyYVdvcmtzcGFjZVdvcmtmbG93XG4gICAgICAgICAgICAgID8uc3RhdGVNYWNoaW5lQXJuID8/IFwiXCIsXG4gICAgICAgICAgRklMRV9JTVBPUlRfV09SS0ZMT1dfQVJOOlxuICAgICAgICAgICAgcHJvcHMucmFnRW5naW5lcz8uZmlsZUltcG9ydFdvcmtmbG93Py5zdGF0ZU1hY2hpbmVBcm4gPz8gXCJcIixcbiAgICAgICAgICBXRUJTSVRFX0NSQVdMSU5HX1dPUktGTE9XX0FSTjpcbiAgICAgICAgICAgIHByb3BzLnJhZ0VuZ2luZXM/LndlYnNpdGVDcmF3bGluZ1dvcmtmbG93Py5zdGF0ZU1hY2hpbmVBcm4gPz8gXCJcIixcbiAgICAgICAgICBPUEVOX1NFQVJDSF9DT0xMRUNUSU9OX0VORFBPSU5UOlxuICAgICAgICAgICAgcHJvcHMucmFnRW5naW5lcz8ub3BlblNlYXJjaFZlY3Rvcj8ub3BlblNlYXJjaENvbGxlY3Rpb25FbmRwb2ludCA/P1xuICAgICAgICAgICAgXCJcIixcbiAgICAgICAgICBERUZBVUxUX0tFTkRSQV9JTkRFWF9JRDpcbiAgICAgICAgICAgIHByb3BzLnJhZ0VuZ2luZXM/LmtlbmRyYVJldHJpZXZhbD8ua2VuZHJhSW5kZXg/LmF0dHJJZCA/PyBcIlwiLFxuICAgICAgICAgIERFRkFVTFRfS0VORFJBX0lOREVYX05BTUU6XG4gICAgICAgICAgICBwcm9wcy5yYWdFbmdpbmVzPy5rZW5kcmFSZXRyaWV2YWw/LmtlbmRyYUluZGV4Py5uYW1lID8/IFwiXCIsXG4gICAgICAgICAgREVGQVVMVF9LRU5EUkFfUzNfREFUQV9TT1VSQ0VfSUQ6XG4gICAgICAgICAgICBwcm9wcy5yYWdFbmdpbmVzPy5rZW5kcmFSZXRyaWV2YWw/LmtlbmRyYVMzRGF0YVNvdXJjZT8uYXR0cklkID8/IFwiXCIsXG4gICAgICAgICAgREVGQVVMVF9LRU5EUkFfUzNfREFUQV9TT1VSQ0VfQlVDS0VUX05BTUU6XG4gICAgICAgICAgICBwcm9wcy5yYWdFbmdpbmVzPy5rZW5kcmFSZXRyaWV2YWw/LmtlbmRyYVMzRGF0YVNvdXJjZUJ1Y2tldFxuICAgICAgICAgICAgICA/LmJ1Y2tldE5hbWUgPz8gXCJcIixcbiAgICAgICAgICBSU1NfRkVFRF9JTkdFU1RPUl9GVU5DVElPTjpcbiAgICAgICAgICAgIHByb3BzLnJhZ0VuZ2luZXM/LmRhdGFJbXBvcnQucnNzSW5nZXN0b3JGdW5jdGlvbj8uZnVuY3Rpb25Bcm4gPz8gXCJcIixcbiAgICAgICAgfSxcbiAgICAgIH1cbiAgICApO1xuXG4gICAgZnVuY3Rpb24gYWRkUGVybWlzc2lvbnMoYXBpSGFuZGxlcjogbGFtYmRhLkZ1bmN0aW9uKSB7XG4gICAgICBpZiAocHJvcHMucmFnRW5naW5lcz8ud29ya3NwYWNlc1RhYmxlKSB7XG4gICAgICAgIHByb3BzLnJhZ0VuZ2luZXMud29ya3NwYWNlc1RhYmxlLmdyYW50UmVhZFdyaXRlRGF0YShhcGlIYW5kbGVyKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHByb3BzLnJhZ0VuZ2luZXM/LmRvY3VtZW50c1RhYmxlKSB7XG4gICAgICAgIHByb3BzLnJhZ0VuZ2luZXMuZG9jdW1lbnRzVGFibGUuZ3JhbnRSZWFkV3JpdGVEYXRhKGFwaUhhbmRsZXIpO1xuICAgICAgICBwcm9wcy5yYWdFbmdpbmVzPy5kYXRhSW1wb3J0LnJzc0luZ2VzdG9yRnVuY3Rpb24/LmdyYW50SW52b2tlKFxuICAgICAgICAgIGFwaUhhbmRsZXJcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHByb3BzLnJhZ0VuZ2luZXM/LmF1cm9yYVBnVmVjdG9yKSB7XG4gICAgICAgIHByb3BzLnJhZ0VuZ2luZXMuYXVyb3JhUGdWZWN0b3IuZGF0YWJhc2Uuc2VjcmV0Py5ncmFudFJlYWQoYXBpSGFuZGxlcik7XG4gICAgICAgIHByb3BzLnJhZ0VuZ2luZXMuYXVyb3JhUGdWZWN0b3IuZGF0YWJhc2UuY29ubmVjdGlvbnMuYWxsb3dEZWZhdWx0UG9ydEZyb20oXG4gICAgICAgICAgYXBpSGFuZGxlclxuICAgICAgICApO1xuXG4gICAgICAgIHByb3BzLnJhZ0VuZ2luZXMuYXVyb3JhUGdWZWN0b3IuY3JlYXRlQXVyb3JhV29ya3NwYWNlV29ya2Zsb3cuZ3JhbnRTdGFydEV4ZWN1dGlvbihcbiAgICAgICAgICBhcGlIYW5kbGVyXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGlmIChwcm9wcy5yYWdFbmdpbmVzPy5vcGVuU2VhcmNoVmVjdG9yKSB7XG4gICAgICAgIGFwaUhhbmRsZXIuYWRkVG9Sb2xlUG9saWN5KFxuICAgICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICAgIGFjdGlvbnM6IFtcImFvc3M6QVBJQWNjZXNzQWxsXCJdLFxuICAgICAgICAgICAgcmVzb3VyY2VzOiBbXG4gICAgICAgICAgICAgIHByb3BzLnJhZ0VuZ2luZXM/Lm9wZW5TZWFyY2hWZWN0b3Iub3BlblNlYXJjaENvbGxlY3Rpb24uYXR0ckFybixcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcblxuICAgICAgICBwcm9wcy5yYWdFbmdpbmVzLm9wZW5TZWFyY2hWZWN0b3IuY3JlYXRlT3BlblNlYXJjaFdvcmtzcGFjZVdvcmtmbG93LmdyYW50U3RhcnRFeGVjdXRpb24oXG4gICAgICAgICAgYXBpSGFuZGxlclxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBpZiAocHJvcHMucmFnRW5naW5lcz8ua2VuZHJhUmV0cmlldmFsKSB7XG4gICAgICAgIHByb3BzLnJhZ0VuZ2luZXMua2VuZHJhUmV0cmlldmFsLmNyZWF0ZUtlbmRyYVdvcmtzcGFjZVdvcmtmbG93LmdyYW50U3RhcnRFeGVjdXRpb24oXG4gICAgICAgICAgYXBpSGFuZGxlclxuICAgICAgICApO1xuXG4gICAgICAgIHByb3BzLnJhZ0VuZ2luZXM/LmtlbmRyYVJldHJpZXZhbD8ua2VuZHJhUzNEYXRhU291cmNlQnVja2V0Py5ncmFudFJlYWRXcml0ZShcbiAgICAgICAgICBhcGlIYW5kbGVyXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKHByb3BzLnJhZ0VuZ2luZXMua2VuZHJhUmV0cmlldmFsLmtlbmRyYUluZGV4KSB7XG4gICAgICAgICAgYXBpSGFuZGxlci5hZGRUb1JvbGVQb2xpY3koXG4gICAgICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgICAgICAgICBcImtlbmRyYTpSZXRyaWV2ZVwiLFxuICAgICAgICAgICAgICAgIFwia2VuZHJhOlF1ZXJ5XCIsXG4gICAgICAgICAgICAgICAgXCJrZW5kcmE6QmF0Y2hEZWxldGVEb2N1bWVudFwiLFxuICAgICAgICAgICAgICAgIFwia2VuZHJhOkJhdGNoUHV0RG9jdW1lbnRcIixcbiAgICAgICAgICAgICAgICBcImtlbmRyYTpTdGFydERhdGFTb3VyY2VTeW5jSm9iXCIsXG4gICAgICAgICAgICAgICAgXCJrZW5kcmE6RGVzY3JpYmVEYXRhU291cmNlU3luY0pvYlwiLFxuICAgICAgICAgICAgICAgIFwia2VuZHJhOlN0b3BEYXRhU291cmNlU3luY0pvYlwiLFxuICAgICAgICAgICAgICAgIFwia2VuZHJhOkxpc3REYXRhU291cmNlU3luY0pvYnNcIixcbiAgICAgICAgICAgICAgICBcImtlbmRyYTpMaXN0RGF0YVNvdXJjZXNcIixcbiAgICAgICAgICAgICAgICBcImtlbmRyYTpEZXNjcmliZUluZGV4XCIsXG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgIHJlc291cmNlczogW1xuICAgICAgICAgICAgICAgIHByb3BzLnJhZ0VuZ2luZXMua2VuZHJhUmV0cmlldmFsLmtlbmRyYUluZGV4LmF0dHJBcm4sXG4gICAgICAgICAgICAgICAgYCR7cHJvcHMucmFnRW5naW5lcy5rZW5kcmFSZXRyaWV2YWwua2VuZHJhSW5kZXguYXR0ckFybn0vKmAsXG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgcHJvcHMuY29uZmlnLnJhZy5lbmdpbmVzLmtlbmRyYS5leHRlcm5hbCA/PyBbXSkge1xuICAgICAgICAgIGlmIChpdGVtLnJvbGVBcm4pIHtcbiAgICAgICAgICAgIGFwaUhhbmRsZXIuYWRkVG9Sb2xlUG9saWN5KFxuICAgICAgICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgICAgICAgYWN0aW9uczogW1wic3RzOkFzc3VtZVJvbGVcIl0sXG4gICAgICAgICAgICAgICAgcmVzb3VyY2VzOiBbaXRlbS5yb2xlQXJuXSxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFwaUhhbmRsZXIuYWRkVG9Sb2xlUG9saWN5KFxuICAgICAgICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgICAgICAgYWN0aW9uczogW1wia2VuZHJhOlJldHJpZXZlXCIsIFwia2VuZHJhOlF1ZXJ5XCJdLFxuICAgICAgICAgICAgICAgIHJlc291cmNlczogW1xuICAgICAgICAgICAgICAgICAgYGFybjoke2Nkay5Bd3MuUEFSVElUSU9OfTprZW5kcmE6JHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5yZWdpb24gPz8gY2RrLkF3cy5SRUdJT05cbiAgICAgICAgICAgICAgICAgIH06JHtjZGsuQXdzLkFDQ09VTlRfSUR9OmluZGV4LyR7aXRlbS5rZW5kcmFJZH1gLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAocHJvcHMucmFnRW5naW5lcz8uZmlsZUltcG9ydFdvcmtmbG93KSB7XG4gICAgICAgIHByb3BzLnJhZ0VuZ2luZXMuZmlsZUltcG9ydFdvcmtmbG93LmdyYW50U3RhcnRFeGVjdXRpb24oYXBpSGFuZGxlcik7XG4gICAgICB9XG5cbiAgICAgIGlmIChwcm9wcy5yYWdFbmdpbmVzPy53ZWJzaXRlQ3Jhd2xpbmdXb3JrZmxvdykge1xuICAgICAgICBwcm9wcy5yYWdFbmdpbmVzLndlYnNpdGVDcmF3bGluZ1dvcmtmbG93LmdyYW50U3RhcnRFeGVjdXRpb24oXG4gICAgICAgICAgYXBpSGFuZGxlclxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBpZiAocHJvcHMucmFnRW5naW5lcz8uZGVsZXRlV29ya3NwYWNlV29ya2Zsb3cpIHtcbiAgICAgICAgcHJvcHMucmFnRW5naW5lcy5kZWxldGVXb3Jrc3BhY2VXb3JrZmxvdy5ncmFudFN0YXJ0RXhlY3V0aW9uKFxuICAgICAgICAgIGFwaUhhbmRsZXJcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHByb3BzLnJhZ0VuZ2luZXM/LnNhZ2VNYWtlclJhZ01vZGVscykge1xuICAgICAgICBhcGlIYW5kbGVyLmFkZFRvUm9sZVBvbGljeShcbiAgICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgICBhY3Rpb25zOiBbXCJzYWdlbWFrZXI6SW52b2tlRW5kcG9pbnRcIl0sXG4gICAgICAgICAgICByZXNvdXJjZXM6IFtwcm9wcy5yYWdFbmdpbmVzLnNhZ2VNYWtlclJhZ01vZGVscy5tb2RlbC5lbmRwb2ludC5yZWZdLFxuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGZvciAoY29uc3QgbW9kZWwgb2YgcHJvcHMubW9kZWxzKSB7XG4gICAgICAgIGFwaUhhbmRsZXIuYWRkVG9Sb2xlUG9saWN5KFxuICAgICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICAgIGFjdGlvbnM6IFtcInNhZ2VtYWtlcjpJbnZva2VFbmRwb2ludFwiXSxcbiAgICAgICAgICAgIHJlc291cmNlczogW21vZGVsLmVuZHBvaW50LnJlZl0sXG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgYXBpSGFuZGxlci5hZGRUb1JvbGVQb2xpY3koXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbXG4gICAgICAgICAgICBcImNvbXByZWhlbmQ6RGV0ZWN0RG9taW5hbnRMYW5ndWFnZVwiLFxuICAgICAgICAgICAgXCJjb21wcmVoZW5kOkRldGVjdFNlbnRpbWVudFwiLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbXCIqXCJdLFxuICAgICAgICB9KVxuICAgICAgKTtcblxuICAgICAgcHJvcHMuc2hhcmVkLnhPcmlnaW5WZXJpZnlTZWNyZXQuZ3JhbnRSZWFkKGFwaUhhbmRsZXIpO1xuICAgICAgcHJvcHMuc2hhcmVkLmFwaUtleXNTZWNyZXQuZ3JhbnRSZWFkKGFwaUhhbmRsZXIpO1xuICAgICAgcHJvcHMuc2hhcmVkLmNvbmZpZ1BhcmFtZXRlci5ncmFudFJlYWQoYXBpSGFuZGxlcik7XG4gICAgICBwcm9wcy5tb2RlbHNQYXJhbWV0ZXIuZ3JhbnRSZWFkKGFwaUhhbmRsZXIpO1xuICAgICAgcHJvcHMuc2Vzc2lvbnNUYWJsZS5ncmFudFJlYWRXcml0ZURhdGEoYXBpSGFuZGxlcik7XG4gICAgICBwcm9wcy5xdWVzdGlvbnNUYWJsZS5ncmFudFJlYWRXcml0ZURhdGEoYXBpSGFuZGxlcik7XG4gICAgICBwcm9wcy5maWxlc0J1Y2tldC5ncmFudFJlYWRXcml0ZShhcGlIYW5kbGVyKTtcbiAgICAgIHByb3BzLnVzZXJGZWVkYmFja0J1Y2tldC5ncmFudFJlYWRXcml0ZShhcGlIYW5kbGVyKTsgICAgICBcbiAgICAgIHByb3BzLnJhZ0VuZ2luZXM/LnVwbG9hZEJ1Y2tldC5ncmFudFJlYWRXcml0ZShhcGlIYW5kbGVyKTtcbiAgICAgIHByb3BzLnJhZ0VuZ2luZXM/LnByb2Nlc3NpbmdCdWNrZXQuZ3JhbnRSZWFkV3JpdGUoYXBpSGFuZGxlcik7XG5cbiAgICAgIGlmIChwcm9wcy5jb25maWcuYmVkcm9jaz8uZW5hYmxlZCkge1xuICAgICAgICBhcGlIYW5kbGVyLmFkZFRvUm9sZVBvbGljeShcbiAgICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgICBhY3Rpb25zOiBbXG4gICAgICAgICAgICAgIFwiYmVkcm9jazpMaXN0Rm91bmRhdGlvbk1vZGVsc1wiLFxuICAgICAgICAgICAgICBcImJlZHJvY2s6TGlzdEN1c3RvbU1vZGVsc1wiLFxuICAgICAgICAgICAgICBcImJlZHJvY2s6SW52b2tlTW9kZWxcIixcbiAgICAgICAgICAgICAgXCJiZWRyb2NrOkludm9rZU1vZGVsV2l0aFJlc3BvbnNlU3RyZWFtXCIsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgcmVzb3VyY2VzOiBbXCIqXCJdLFxuICAgICAgICAgIH0pXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKHByb3BzLmNvbmZpZy5iZWRyb2NrPy5yb2xlQXJuKSB7XG4gICAgICAgICAgYXBpSGFuZGxlci5hZGRUb1JvbGVQb2xpY3koXG4gICAgICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgICAgIGFjdGlvbnM6IFtcInN0czpBc3N1bWVSb2xlXCJdLFxuICAgICAgICAgICAgICByZXNvdXJjZXM6IFtwcm9wcy5jb25maWcuYmVkcm9jay5yb2xlQXJuXSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGFkZFBlcm1pc3Npb25zKGFwcFN5bmNMYW1iZGFSZXNvbHZlcik7XG5cbiAgICBwcm9wcy5yYWdFbmdpbmVzPy5vcGVuU2VhcmNoVmVjdG9yPy5hZGRUb0FjY2Vzc1BvbGljeShcbiAgICAgIFwiZ3JhcGhxbC1hcGlcIixcbiAgICAgIFthcHBTeW5jTGFtYmRhUmVzb2x2ZXIucm9sZT8ucm9sZUFybl0sXG4gICAgICBbXCJhb3NzOkRlc2NyaWJlSW5kZXhcIiwgXCJhb3NzOlJlYWREb2N1bWVudFwiLCBcImFvc3M6V3JpdGVEb2N1bWVudFwiXVxuICAgICk7XG5cbiAgICBjb25zdCBmdW5jdGlvbkRhdGFTb3VyY2UgPSBwcm9wcy5hcGkuYWRkTGFtYmRhRGF0YVNvdXJjZShcbiAgICAgIFwicHJveHlSZXNvbHZlckZ1bmN0aW9uXCIsXG4gICAgICBhcHBTeW5jTGFtYmRhUmVzb2x2ZXJcbiAgICApO1xuXG4gICAgY29uc3Qgc2NoZW1hID0gcGFyc2UoXG4gICAgICByZWFkRmlsZVN5bmMoXCJsaWIvY2hhdGJvdC1hcGkvc2NoZW1hL3NjaGVtYS5ncmFwaHFsXCIsIFwidXRmOFwiKVxuICAgICk7XG5cbiAgICBmdW5jdGlvbiBhZGRSZXNvbHZlcnMob3BlcmF0aW9uVHlwZTogc3RyaW5nKSB7XG4gICAgICBjb25zdCBmaWVsZE5hbWVzID0gKFxuICAgICAgICBzY2hlbWEuZGVmaW5pdGlvbnNcbiAgICAgICAgICAuZmlsdGVyKCh4KSA9PiB4LmtpbmQgPT0gXCJPYmplY3RUeXBlRGVmaW5pdGlvblwiKVxuICAgICAgICAgIC5maWx0ZXIoKHk6IGFueSkgPT4geS5uYW1lLnZhbHVlID09IG9wZXJhdGlvblR5cGUpWzBdIGFzIGFueVxuICAgICAgKS5maWVsZHMubWFwKCh6OiBhbnkpID0+IHoubmFtZS52YWx1ZSk7XG5cbiAgICAgIGZvciAoY29uc3QgZmllbGROYW1lIG9mIGZpZWxkTmFtZXMpIHtcbiAgICAgICAgLy8gVGhlc2UgcmVzb2x2ZXJzIGFyZSBhZGRlZCBieSB0aGUgUmVhbHRpbWUgQVBJXG4gICAgICAgIGlmIChmaWVsZE5hbWUgPT0gXCJzZW5kUXVlcnlcIiB8fCBmaWVsZE5hbWUgPT0gXCJwdWJsaXNoUmVzcG9uc2VcIikge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIHByb3BzLmFwaS5jcmVhdGVSZXNvbHZlcihgJHtmaWVsZE5hbWV9LXJlc29sdmVyYCwge1xuICAgICAgICAgIHR5cGVOYW1lOiBvcGVyYXRpb25UeXBlLFxuICAgICAgICAgIGZpZWxkTmFtZTogZmllbGROYW1lLFxuICAgICAgICAgIGRhdGFTb3VyY2U6IGZ1bmN0aW9uRGF0YVNvdXJjZSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgYWRkUmVzb2x2ZXJzKFwiUXVlcnlcIik7XG4gICAgYWRkUmVzb2x2ZXJzKFwiTXV0YXRpb25cIik7XG4gIH1cbn1cbiJdfQ==