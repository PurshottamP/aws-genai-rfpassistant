"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Models = void 0;
const ssm = require("aws-cdk-lib/aws-ssm");
const constructs_1 = require("constructs");
const iam = require("aws-cdk-lib/aws-iam");
const types_1 = require("../shared/types");
const generative_ai_cdk_constructs_1 = require("@cdklabs/generative-ai-cdk-constructs");
const cdk_nag_1 = require("cdk-nag");
const sagemaker_schedule_1 = require("./sagemaker-schedule");
class Models extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        const models = [];
        if (props.config.llms?.sagemaker.includes(types_1.SupportedSageMakerModels.FalconLite)) {
            const FALCON_MODEL_ID = "amazon/FalconLite";
            const FALCON_ENDPOINT_NAME = FALCON_MODEL_ID.split("/")
                .join("-")
                .split(".")
                .join("-");
            const falconLite = new generative_ai_cdk_constructs_1.HuggingFaceSageMakerEndpoint(this, "FalconLite", {
                modelId: FALCON_MODEL_ID,
                vpcConfig: {
                    securityGroupIds: [props.shared.vpc.vpcDefaultSecurityGroup],
                    subnets: props.shared.vpc.privateSubnets.map((subnet) => subnet.subnetId),
                },
                container: generative_ai_cdk_constructs_1.DeepLearningContainerImage.HUGGINGFACE_PYTORCH_TGI_INFERENCE_2_0_1_TGI0_9_3_GPU_PY39_CU118_UBUNTU20_04,
                instanceType: generative_ai_cdk_constructs_1.SageMakerInstanceType.ML_G5_12XLARGE,
                startupHealthCheckTimeoutInSeconds: 600,
                endpointName: FALCON_ENDPOINT_NAME,
                environment: {
                    SM_NUM_GPUS: JSON.stringify(4),
                    MAX_INPUT_LENGTH: JSON.stringify(12000),
                    MAX_TOTAL_TOKENS: JSON.stringify(12001),
                    HF_MODEL_QUANTIZE: "gptq",
                    TRUST_REMOTE_CODE: JSON.stringify(true),
                    MAX_BATCH_PREFILL_TOKENS: JSON.stringify(12001),
                    MAX_BATCH_TOTAL_TOKENS: JSON.stringify(12001),
                    GPTQ_BITS: JSON.stringify(4),
                    GPTQ_GROUPSIZE: JSON.stringify(128),
                    DNTK_ALPHA_SCALER: JSON.stringify(0.25),
                },
            });
            this.suppressCdkNagWarningForEndpointRole(falconLite.role);
            models.push({
                name: FALCON_ENDPOINT_NAME,
                endpoint: falconLite.cfnEndpoint,
                responseStreamingSupported: false,
                inputModalities: [types_1.Modality.Text],
                outputModalities: [types_1.Modality.Text],
                interface: types_1.ModelInterface.LangChain,
                ragSupported: true,
            });
        }
        if (props.config.llms?.sagemaker.includes(types_1.SupportedSageMakerModels.Mistral7b_Instruct)) {
            const MISTRAL_7B_MODEL_ID = "mistralai/Mistral-7B-Instruct-v0.1";
            const MISTRAL_7B_ENDPOINT_NAME = MISTRAL_7B_MODEL_ID.split("/")
                .join("-")
                .split(".")
                .join("-");
            const mistral7B = new generative_ai_cdk_constructs_1.HuggingFaceSageMakerEndpoint(this, "Mistral7BInstruct", {
                modelId: MISTRAL_7B_MODEL_ID,
                vpcConfig: {
                    securityGroupIds: [props.shared.vpc.vpcDefaultSecurityGroup],
                    subnets: props.shared.vpc.privateSubnets.map((subnet) => subnet.subnetId),
                },
                container: generative_ai_cdk_constructs_1.DeepLearningContainerImage.HUGGINGFACE_PYTORCH_TGI_INFERENCE_2_0_1_TGI1_1_0_GPU_PY39_CU118_UBUNTU20_04,
                instanceType: generative_ai_cdk_constructs_1.SageMakerInstanceType.ML_G5_2XLARGE,
                startupHealthCheckTimeoutInSeconds: 300,
                endpointName: MISTRAL_7B_ENDPOINT_NAME,
                environment: {
                    SM_NUM_GPUS: JSON.stringify(1),
                    MAX_INPUT_LENGTH: JSON.stringify(2048),
                    MAX_TOTAL_TOKENS: JSON.stringify(4096),
                },
            });
            this.suppressCdkNagWarningForEndpointRole(mistral7B.role);
            models.push({
                name: MISTRAL_7B_ENDPOINT_NAME,
                endpoint: mistral7B.cfnEndpoint,
                responseStreamingSupported: false,
                inputModalities: [types_1.Modality.Text],
                outputModalities: [types_1.Modality.Text],
                interface: types_1.ModelInterface.LangChain,
                ragSupported: true,
            });
        }
        if (props.config.llms?.sagemaker.includes(types_1.SupportedSageMakerModels.Mistral7b_Instruct2)) {
            const MISTRAL_7B_INSTRUCT2_MODEL_ID = "mistralai/Mistral-7B-Instruct-v0.2";
            const MISTRAL_7B_INSTRUCT2_ENDPOINT_NAME = MISTRAL_7B_INSTRUCT2_MODEL_ID.split("/").join("-").split(".").join("-");
            const mistral7BInstruct2 = new generative_ai_cdk_constructs_1.HuggingFaceSageMakerEndpoint(this, "Mistral7BInstruct2", {
                modelId: MISTRAL_7B_INSTRUCT2_MODEL_ID,
                vpcConfig: {
                    securityGroupIds: [props.shared.vpc.vpcDefaultSecurityGroup],
                    subnets: props.shared.vpc.privateSubnets.map((subnet) => subnet.subnetId),
                },
                container: generative_ai_cdk_constructs_1.DeepLearningContainerImage.fromDeepLearningContainerImage("huggingface-pytorch-tgi-inference", "2.1.1-tgi1.3.3-gpu-py310-cu121-ubuntu20.04"),
                instanceType: generative_ai_cdk_constructs_1.SageMakerInstanceType.ML_G5_2XLARGE,
                startupHealthCheckTimeoutInSeconds: 300,
                endpointName: MISTRAL_7B_INSTRUCT2_ENDPOINT_NAME,
                environment: {
                    SM_NUM_GPUS: JSON.stringify(1),
                    MAX_INPUT_LENGTH: JSON.stringify(2048),
                    MAX_TOTAL_TOKENS: JSON.stringify(4096),
                    MAX_CONCURRENT_REQUESTS: JSON.stringify(4),
                },
            });
            this.suppressCdkNagWarningForEndpointRole(mistral7BInstruct2.role);
            models.push({
                name: MISTRAL_7B_INSTRUCT2_ENDPOINT_NAME,
                endpoint: mistral7BInstruct2.cfnEndpoint,
                responseStreamingSupported: false,
                inputModalities: [types_1.Modality.Text],
                outputModalities: [types_1.Modality.Text],
                interface: types_1.ModelInterface.LangChain,
                ragSupported: true,
            });
        }
        if (props.config.llms?.sagemaker.includes(types_1.SupportedSageMakerModels.Mixtral_8x7b_Instruct)) {
            const MISTRAL_8x7B_MODEL_ID = "mistralai/Mixtral-8x7B-Instruct-v0.1";
            const MISTRAL_8x7B_INSTRUCT2_ENDPOINT_NAME = MISTRAL_8x7B_MODEL_ID.split("/")
                .join("-")
                .split(".")
                .join("-");
            const mistral8x7B = new generative_ai_cdk_constructs_1.HuggingFaceSageMakerEndpoint(this, "Mixtral8x7binstruct", {
                modelId: MISTRAL_8x7B_MODEL_ID,
                vpcConfig: {
                    securityGroupIds: [props.shared.vpc.vpcDefaultSecurityGroup],
                    subnets: props.shared.vpc.privateSubnets.map((subnet) => subnet.subnetId),
                },
                container: generative_ai_cdk_constructs_1.DeepLearningContainerImage.fromDeepLearningContainerImage("huggingface-pytorch-tgi-inference", "2.1.1-tgi1.3.3-gpu-py310-cu121-ubuntu20.04"),
                instanceType: generative_ai_cdk_constructs_1.SageMakerInstanceType.ML_G5_48XLARGE,
                startupHealthCheckTimeoutInSeconds: 300,
                endpointName: MISTRAL_8x7B_INSTRUCT2_ENDPOINT_NAME,
                environment: {
                    SM_NUM_GPUS: JSON.stringify(8),
                    MAX_INPUT_LENGTH: JSON.stringify(24576),
                    MAX_TOTAL_TOKENS: JSON.stringify(32768),
                    MAX_BATCH_PREFILL_TOKENS: JSON.stringify(24576),
                    MAX_CONCURRENT_REQUESTS: JSON.stringify(4),
                },
            });
            this.suppressCdkNagWarningForEndpointRole(mistral8x7B.role);
            models.push({
                name: MISTRAL_8x7B_INSTRUCT2_ENDPOINT_NAME,
                endpoint: mistral8x7B.cfnEndpoint,
                responseStreamingSupported: false,
                inputModalities: [types_1.Modality.Text],
                outputModalities: [types_1.Modality.Text],
                interface: types_1.ModelInterface.LangChain,
                ragSupported: true,
            });
        }
        if (props.config.llms?.sagemaker.includes(types_1.SupportedSageMakerModels.Llama2_13b_Chat)) {
            const LLAMA2_13B_CHAT_ENDPOINT_NAME = "meta-LLama2-13b-chat";
            const llama2_13b_chat = new generative_ai_cdk_constructs_1.JumpStartSageMakerEndpoint(this, "LLamaV2_13B_Chat", {
                model: generative_ai_cdk_constructs_1.JumpStartModel.META_TEXTGENERATION_LLAMA_2_13B_F_2_0_2,
                instanceType: generative_ai_cdk_constructs_1.SageMakerInstanceType.ML_G5_12XLARGE,
                vpcConfig: {
                    securityGroupIds: [props.shared.vpc.vpcDefaultSecurityGroup],
                    subnets: props.shared.vpc.privateSubnets.map((subnet) => subnet.subnetId),
                },
                endpointName: LLAMA2_13B_CHAT_ENDPOINT_NAME,
            });
            this.suppressCdkNagWarningForEndpointRole(llama2_13b_chat.role);
            models.push({
                name: LLAMA2_13B_CHAT_ENDPOINT_NAME,
                endpoint: llama2_13b_chat.cfnEndpoint,
                responseStreamingSupported: false,
                inputModalities: [types_1.Modality.Text],
                outputModalities: [types_1.Modality.Text],
                interface: types_1.ModelInterface.LangChain,
                ragSupported: true,
            });
        }
        if (props.config.llms?.sagemaker.includes(types_1.SupportedSageMakerModels.Idefics_9b)) {
            const IDEFICS_9B_MODEL_ID = "HuggingFaceM4/idefics-9b-instruct";
            const IDEFICS_9B_ENDPOINT_NAME = IDEFICS_9B_MODEL_ID.split("/")
                .join("-")
                .split(".")
                .join("-");
            const idefics9b = new generative_ai_cdk_constructs_1.HuggingFaceSageMakerEndpoint(this, "IDEFICS9B", {
                modelId: IDEFICS_9B_MODEL_ID,
                vpcConfig: {
                    securityGroupIds: [props.shared.vpc.vpcDefaultSecurityGroup],
                    subnets: props.shared.vpc.privateSubnets.map((subnet) => subnet.subnetId),
                },
                container: generative_ai_cdk_constructs_1.DeepLearningContainerImage.HUGGINGFACE_PYTORCH_TGI_INFERENCE_2_0_1_TGI1_1_0_GPU_PY39_CU118_UBUNTU20_04,
                instanceType: generative_ai_cdk_constructs_1.SageMakerInstanceType.ML_G5_12XLARGE,
                startupHealthCheckTimeoutInSeconds: 300,
                endpointName: IDEFICS_9B_ENDPOINT_NAME,
                environment: {
                    SM_NUM_GPUS: JSON.stringify(4),
                    MAX_INPUT_LENGTH: JSON.stringify(1024),
                    MAX_TOTAL_TOKENS: JSON.stringify(2048),
                    MAX_BATCH_TOTAL_TOKENS: JSON.stringify(8192),
                },
            });
            this.suppressCdkNagWarningForEndpointRole(idefics9b.role);
            models.push({
                name: IDEFICS_9B_ENDPOINT_NAME,
                endpoint: idefics9b.cfnEndpoint,
                responseStreamingSupported: false,
                inputModalities: [types_1.Modality.Text, types_1.Modality.Image],
                outputModalities: [types_1.Modality.Text],
                interface: types_1.ModelInterface.MultiModal,
                ragSupported: false,
            });
        }
        if (props.config.llms?.sagemaker.includes(types_1.SupportedSageMakerModels.Idefics_80b)) {
            const IDEFICS_80B_MODEL_ID = "HuggingFaceM4/idefics-80b-instruct";
            const IDEFICS_80B_ENDPOINT_NAME = IDEFICS_80B_MODEL_ID.split("/")
                .join("-")
                .split(".")
                .join("-");
            const idefics80b = new generative_ai_cdk_constructs_1.HuggingFaceSageMakerEndpoint(this, "IDEFICS80B", {
                modelId: IDEFICS_80B_MODEL_ID,
                vpcConfig: {
                    securityGroupIds: [props.shared.vpc.vpcDefaultSecurityGroup],
                    subnets: props.shared.vpc.privateSubnets.map((subnet) => subnet.subnetId),
                },
                container: generative_ai_cdk_constructs_1.DeepLearningContainerImage.HUGGINGFACE_PYTORCH_TGI_INFERENCE_2_0_1_TGI1_1_0_GPU_PY39_CU118_UBUNTU20_04,
                instanceType: generative_ai_cdk_constructs_1.SageMakerInstanceType.ML_G5_48XLARGE,
                startupHealthCheckTimeoutInSeconds: 600,
                endpointName: IDEFICS_80B_ENDPOINT_NAME,
                environment: {
                    SM_NUM_GPUS: JSON.stringify(8),
                    MAX_INPUT_LENGTH: JSON.stringify(1024),
                    MAX_TOTAL_TOKENS: JSON.stringify(2048),
                    MAX_BATCH_TOTAL_TOKENS: JSON.stringify(8192),
                    // quantization required to work with ml.g5.48xlarge
                    // comment if deploying with ml.p4d or ml.p4e instances
                    HF_MODEL_QUANTIZE: "bitsandbytes",
                },
            });
            this.suppressCdkNagWarningForEndpointRole(idefics80b.role);
            models.push({
                name: IDEFICS_80B_ENDPOINT_NAME,
                endpoint: idefics80b.cfnEndpoint,
                responseStreamingSupported: false,
                inputModalities: [types_1.Modality.Text, types_1.Modality.Image],
                outputModalities: [types_1.Modality.Text],
                interface: types_1.ModelInterface.MultiModal,
                ragSupported: false,
            });
        }
        const modelsParameter = new ssm.StringParameter(this, "ModelsParameter", {
            stringValue: JSON.stringify(models.map((model) => ({
                name: model.name,
                endpoint: model.endpoint.endpointName,
                responseStreamingSupported: model.responseStreamingSupported,
                inputModalities: model.inputModalities,
                outputModalities: model.outputModalities,
                interface: model.interface,
                ragSupported: model.ragSupported,
            }))),
        });
        this.models = models;
        this.modelsParameter = modelsParameter;
        if (models.length > 0 && props.config.llms?.sagemakerSchedule?.enabled) {
            let schedulerRole = new iam.Role(this, 'SchedulerRole', {
                assumedBy: new iam.ServicePrincipal('scheduler.amazonaws.com'),
                description: 'Role for Scheduler to interact with SageMaker',
            });
            schedulerRole.addManagedPolicy(iam.ManagedPolicy.fromAwsManagedPolicyName('AmazonSageMakerFullAccess'));
            this.suppressCdkNagWarningForEndpointRole(schedulerRole);
            models.forEach((model) => {
                sagemaker_schedule_1.createStartSchedule(this, id, model.endpoint, schedulerRole, props.config);
                sagemaker_schedule_1.createStopSchedule(this, id, model.endpoint, schedulerRole, props.config);
            });
        }
    }
    suppressCdkNagWarningForEndpointRole(role) {
        cdk_nag_1.NagSuppressions.addResourceSuppressions(role, [
            {
                id: "AwsSolutions-IAM4",
                reason: "Gives user ability to deploy and delete endpoints from the UI.",
            },
            {
                id: "AwsSolutions-IAM5",
                reason: "Gives user ability to deploy and delete endpoints from the UI.",
            },
        ], true);
    }
}
exports.Models = Models;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSwyQ0FBMkM7QUFDM0MsMkNBQXVDO0FBQ3ZDLDJDQUEyQztBQUUzQywyQ0FNeUI7QUFDekIsd0ZBTStDO0FBQy9DLHFDQUEwQztBQUMxQyw2REFBOEU7QUFPOUUsTUFBYSxNQUFPLFNBQVEsc0JBQVM7SUFJbkMsWUFBWSxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUFrQjtRQUMxRCxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRWpCLE1BQU0sTUFBTSxHQUE2QixFQUFFLENBQUM7UUFFNUMsSUFDRSxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsUUFBUSxDQUFDLGdDQUF3QixDQUFDLFVBQVUsQ0FBQyxFQUMxRTtZQUNBLE1BQU0sZUFBZSxHQUFHLG1CQUFtQixDQUFDO1lBQzVDLE1BQU0sb0JBQW9CLEdBQUcsZUFBZSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7aUJBQ3BELElBQUksQ0FBQyxHQUFHLENBQUM7aUJBQ1QsS0FBSyxDQUFDLEdBQUcsQ0FBQztpQkFDVixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFYixNQUFNLFVBQVUsR0FBRyxJQUFJLDJEQUE0QixDQUFDLElBQUksRUFBRSxZQUFZLEVBQUU7Z0JBQ3RFLE9BQU8sRUFBRSxlQUFlO2dCQUN4QixTQUFTLEVBQUU7b0JBQ1QsZ0JBQWdCLEVBQUUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsQ0FBQztvQkFDNUQsT0FBTyxFQUFFLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQzFDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUM1QjtpQkFDRjtnQkFDRCxTQUFTLEVBQ1AseURBQTBCLENBQUMsMkVBQTJFO2dC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QUFDLElBQUksRUFBRSxFQUFFLEVBQUUsS0FBSyxDQUFDLFFBQVEsRUFBRSxhQUFhLEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzlFLENBQUMsQ0FBQyxDQUFDO1NBQ0o7SUFDSCxDQUFDO0lBRU8sb0NBQW9DLENBQUMsSUFBYztRQUN6RCx5QkFBZSxDQUFDLHVCQUF1QixDQUNyQyxJQUFJLEVBQ0o7WUFDRTtnQkFDRSxFQUFFLEVBQUUsbUJBQW1CO2dCQUN2QixNQUFNLEVBQ0osZ0VBQWdFO2FBQ25FO1lBQ0Q7Z0JBQ0UsRUFBRSxFQUFFLG1CQUFtQjtnQkFDdkIsTUFBTSxFQUNKLGdFQUFnRTthQUNuRTtTQUNGLEVBQ0QsSUFBSSxDQUNMLENBQUM7SUFDSixDQUFDO0NBQ0Y7QUFyWUQsd0JBcVlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgY2RrIGZyb20gXCJhd3MtY2RrLWxpYlwiO1xuaW1wb3J0ICogYXMgc3NtIGZyb20gXCJhd3MtY2RrLWxpYi9hd3Mtc3NtXCI7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tIFwiY29uc3RydWN0c1wiO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtaWFtXCI7XG5pbXBvcnQgeyBTaGFyZWQgfSBmcm9tIFwiLi4vc2hhcmVkXCI7XG5pbXBvcnQge1xuICBNb2RhbGl0eSxcbiAgTW9kZWxJbnRlcmZhY2UsXG4gIFNhZ2VNYWtlck1vZGVsRW5kcG9pbnQsXG4gIFN1cHBvcnRlZFNhZ2VNYWtlck1vZGVscyxcbiAgU3lzdGVtQ29uZmlnLFxufSBmcm9tIFwiLi4vc2hhcmVkL3R5cGVzXCI7XG5pbXBvcnQge1xuICBIdWdnaW5nRmFjZVNhZ2VNYWtlckVuZHBvaW50LFxuICBKdW1wU3RhcnRTYWdlTWFrZXJFbmRwb2ludCxcbiAgU2FnZU1ha2VySW5zdGFuY2VUeXBlLFxuICBEZWVwTGVhcm5pbmdDb250YWluZXJJbWFnZSxcbiAgSnVtcFN0YXJ0TW9kZWwsXG59IGZyb20gXCJAY2RrbGFicy9nZW5lcmF0aXZlLWFpLWNkay1jb25zdHJ1Y3RzXCI7XG5pbXBvcnQgeyBOYWdTdXBwcmVzc2lvbnMgfSBmcm9tIFwiY2RrLW5hZ1wiO1xuaW1wb3J0IHsgY3JlYXRlU3RhcnRTY2hlZHVsZSwgY3JlYXRlU3RvcFNjaGVkdWxlIH0gZnJvbSBcIi4vc2FnZW1ha2VyLXNjaGVkdWxlXCJcblxuZXhwb3J0IGludGVyZmFjZSBNb2RlbHNQcm9wcyB7XG4gIHJlYWRvbmx5IGNvbmZpZzogU3lzdGVtQ29uZmlnO1xuICByZWFkb25seSBzaGFyZWQ6IFNoYXJlZDtcbn1cblxuZXhwb3J0IGNsYXNzIE1vZGVscyBleHRlbmRzIENvbnN0cnVjdCB7XG4gIHB1YmxpYyByZWFkb25seSBtb2RlbHM6IFNhZ2VNYWtlck1vZGVsRW5kcG9pbnRbXTtcbiAgcHVibGljIHJlYWRvbmx5IG1vZGVsc1BhcmFtZXRlcjogc3NtLlN0cmluZ1BhcmFtZXRlcjtcblxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogTW9kZWxzUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuXG4gICAgY29uc3QgbW9kZWxzOiBTYWdlTWFrZXJNb2RlbEVuZHBvaW50W10gPSBbXTtcblxuICAgIGlmIChcbiAgICAgIHByb3BzLmNvbmZpZy5sbG1zPy5zYWdlbWFrZXIuaW5jbHVkZXMoU3VwcG9ydGVkU2FnZU1ha2VyTW9kZWxzLkZhbGNvbkxpdGUpXG4gICAgKSB7XG4gICAgICBjb25zdCBGQUxDT05fTU9ERUxfSUQgPSBcImFtYXpvbi9GYWxjb25MaXRlXCI7XG4gICAgICBjb25zdCBGQUxDT05fRU5EUE9JTlRfTkFNRSA9IEZBTENPTl9NT0RFTF9JRC5zcGxpdChcIi9cIilcbiAgICAgICAgLmpvaW4oXCItXCIpXG4gICAgICAgIC5zcGxpdChcIi5cIilcbiAgICAgICAgLmpvaW4oXCItXCIpO1xuXG4gICAgICBjb25zdCBmYWxjb25MaXRlID0gbmV3IEh1Z2dpbmdGYWNlU2FnZU1ha2VyRW5kcG9pbnQodGhpcywgXCJGYWxjb25MaXRlXCIsIHtcbiAgICAgICAgbW9kZWxJZDogRkFMQ09OX01PREVMX0lELFxuICAgICAgICB2cGNDb25maWc6IHtcbiAgICAgICAgICBzZWN1cml0eUdyb3VwSWRzOiBbcHJvcHMuc2hhcmVkLnZwYy52cGNEZWZhdWx0U2VjdXJpdHlHcm91cF0sXG4gICAgICAgICAgc3VibmV0czogcHJvcHMuc2hhcmVkLnZwYy5wcml2YXRlU3VibmV0cy5tYXAoXG4gICAgICAgICAgICAoc3VibmV0KSA9PiBzdWJuZXQuc3VibmV0SWRcbiAgICAgICAgICApLFxuICAgICAgICB9LFxuICAgICAgICBjb250YWluZXI6XG4gICAgICAgICAgRGVlcExlYXJuaW5nQ29udGFpbmVySW1hZ2UuSFVHR0lOR0ZBQ0VfUFlUT1JDSF9UR0lfSU5GRVJFTkNFXzJfMF8xX1RHSTBfOV8zX0dQVV9QWTM5X0NVMTE4X1VCVU5UVTIwXzA0LFxuICAgICAgICBpbnN0YW5jZVR5cGU6IFNhZ2VNYWtlckluc3RhbmNlVHlwZS5NTF9HNV8xMlhMQVJHRSxcbiAgICAgICAgc3RhcnR1cEhlYWx0aENoZWNrVGltZW91dEluU2Vjb25kczogNjAwLFxuICAgICAgICBlbmRwb2ludE5hbWU6IEZBTENPTl9FTkRQT0lOVF9OQU1FLFxuICAgICAgICBlbnZpcm9ubWVudDoge1xuICAgICAgICAgIFNNX05VTV9HUFVTOiBKU09OLnN0cmluZ2lmeSg0KSxcbiAgICAgICAgICBNQVhfSU5QVVRfTEVOR1RIOiBKU09OLnN0cmluZ2lmeSgxMjAwMCksXG4gICAgICAgICAgTUFYX1RPVEFMX1RPS0VOUzogSlNPTi5zdHJpbmdpZnkoMTIwMDEpLFxuICAgICAgICAgIEhGX01PREVMX1FVQU5USVpFOiBcImdwdHFcIixcbiAgICAgICAgICBUUlVTVF9SRU1PVEVfQ09ERTogSlNPTi5zdHJpbmdpZnkodHJ1ZSksXG4gICAgICAgICAgTUFYX0JBVENIX1BSRUZJTExfVE9LRU5TOiBKU09OLnN0cmluZ2lmeSgxMjAwMSksXG4gICAgICAgICAgTUFYX0JBVENIX1RPVEFMX1RPS0VOUzogSlNPTi5zdHJpbmdpZnkoMTIwMDEpLFxuICAgICAgICAgIEdQVFFfQklUUzogSlNPTi5zdHJpbmdpZnkoNCksXG4gICAgICAgICAgR1BUUV9HUk9VUFNJWkU6IEpTT04uc3RyaW5naWZ5KDEyOCksXG4gICAgICAgICAgRE5US19BTFBIQV9TQ0FMRVI6IEpTT04uc3RyaW5naWZ5KDAuMjUpLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuc3VwcHJlc3NDZGtOYWdXYXJuaW5nRm9yRW5kcG9pbnRSb2xlKGZhbGNvbkxpdGUucm9sZSk7XG5cbiAgICAgIG1vZGVscy5wdXNoKHtcbiAgICAgICAgbmFtZTogRkFMQ09OX0VORFBPSU5UX05BTUUhLFxuICAgICAgICBlbmRwb2ludDogZmFsY29uTGl0ZS5jZm5FbmRwb2ludCxcbiAgICAgICAgcmVzcG9uc2VTdHJlYW1pbmdTdXBwb3J0ZWQ6IGZhbHNlLFxuICAgICAgICBpbnB1dE1vZGFsaXRpZXM6IFtNb2RhbGl0eS5UZXh0XSxcbiAgICAgICAgb3V0cHV0TW9kYWxpdGllczogW01vZGFsaXR5LlRleHRdLFxuICAgICAgICBpbnRlcmZhY2U6IE1vZGVsSW50ZXJmYWNlLkxhbmdDaGFpbixcbiAgICAgICAgcmFnU3VwcG9ydGVkOiB0cnVlLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgcHJvcHMuY29uZmlnLmxsbXM/LnNhZ2VtYWtlci5pbmNsdWRlcyhcbiAgICAgICAgU3VwcG9ydGVkU2FnZU1ha2VyTW9kZWxzLk1pc3RyYWw3Yl9JbnN0cnVjdFxuICAgICAgKVxuICAgICkge1xuICAgICAgY29uc3QgTUlTVFJBTF83Ql9NT0RFTF9JRCA9IFwibWlzdHJhbGFpL01pc3RyYWwtN0ItSW5zdHJ1Y3QtdjAuMVwiO1xuICAgICAgY29uc3QgTUlTVFJBTF83Ql9FTkRQT0lOVF9OQU1FID0gTUlTVFJBTF83Ql9NT0RFTF9JRC5zcGxpdChcIi9cIilcbiAgICAgICAgLmpvaW4oXCItXCIpXG4gICAgICAgIC5zcGxpdChcIi5cIilcbiAgICAgICAgLmpvaW4oXCItXCIpO1xuXG4gICAgICBjb25zdCBtaXN0cmFsN0IgPSBuZXcgSHVnZ2luZ0ZhY2VTYWdlTWFrZXJFbmRwb2ludChcbiAgICAgICAgdGhpcyxcbiAgICAgICAgXCJNaXN0cmFsN0JJbnN0cnVjdFwiLFxuICAgICAgICB7XG4gICAgICAgICAgbW9kZWxJZDogTUlTVFJBTF83Ql9NT0RFTF9JRCxcbiAgICAgICAgICB2cGNDb25maWc6IHtcbiAgICAgICAgICAgIHNlY3VyaXR5R3JvdXBJZHM6IFtwcm9wcy5zaGFyZWQudnBjLnZwY0RlZmF1bHRTZWN1cml0eUdyb3VwXSxcbiAgICAgICAgICAgIHN1Ym5ldHM6IHByb3BzLnNoYXJlZC52cGMucHJpdmF0ZVN1Ym5ldHMubWFwKFxuICAgICAgICAgICAgICAoc3VibmV0KSA9PiBzdWJuZXQuc3VibmV0SWRcbiAgICAgICAgICAgICksXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjb250YWluZXI6XG4gICAgICAgICAgICBEZWVwTGVhcm5pbmdDb250YWluZXJJbWFnZS5IVUdHSU5HRkFDRV9QWVRPUkNIX1RHSV9JTkZFUkVOQ0VfMl8wXzFfVEdJMV8xXzBfR1BVX1BZMzlfQ1UxMThfVUJVTlRVMjBfMDQsXG4gICAgICAgICAgaW5zdGFuY2VUeXBlOiBTYWdlTWFrZXJJbnN0YW5jZVR5cGUuTUxfRzVfMlhMQVJHRSxcbiAgICAgICAgICBzdGFydHVwSGVhbHRoQ2hlY2tUaW1lb3V0SW5TZWNvbmRzOiAzMDAsXG4gICAgICAgICAgZW5kcG9pbnROYW1lOiBNSVNUUkFMXzdCX0VORFBPSU5UX05BTUUsXG4gICAgICAgICAgZW52aXJvbm1lbnQ6IHtcbiAgICAgICAgICAgIFNNX05VTV9HUFVTOiBKU09OLnN0cmluZ2lmeSgxKSxcbiAgICAgICAgICAgIE1BWF9JTlBVVF9MRU5HVEg6IEpTT04uc3RyaW5naWZ5KDIwNDgpLFxuICAgICAgICAgICAgTUFYX1RPVEFMX1RPS0VOUzogSlNPTi5zdHJpbmdpZnkoNDA5NiksXG4gICAgICAgICAgfSxcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgdGhpcy5zdXBwcmVzc0Nka05hZ1dhcm5pbmdGb3JFbmRwb2ludFJvbGUobWlzdHJhbDdCLnJvbGUpO1xuXG4gICAgICBtb2RlbHMucHVzaCh7XG4gICAgICAgIG5hbWU6IE1JU1RSQUxfN0JfRU5EUE9JTlRfTkFNRSEsXG4gICAgICAgIGVuZHBvaW50OiBtaXN0cmFsN0IuY2ZuRW5kcG9pbnQsXG4gICAgICAgIHJlc3BvbnNlU3RyZWFtaW5nU3VwcG9ydGVkOiBmYWxzZSxcbiAgICAgICAgaW5wdXRNb2RhbGl0aWVzOiBbTW9kYWxpdHkuVGV4dF0sXG4gICAgICAgIG91dHB1dE1vZGFsaXRpZXM6IFtNb2RhbGl0eS5UZXh0XSxcbiAgICAgICAgaW50ZXJmYWNlOiBNb2RlbEludGVyZmFjZS5MYW5nQ2hhaW4sXG4gICAgICAgIHJhZ1N1cHBvcnRlZDogdHJ1ZSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIHByb3BzLmNvbmZpZy5sbG1zPy5zYWdlbWFrZXIuaW5jbHVkZXMoXG4gICAgICAgIFN1cHBvcnRlZFNhZ2VNYWtlck1vZGVscy5NaXN0cmFsN2JfSW5zdHJ1Y3QyXG4gICAgICApXG4gICAgKSB7XG4gICAgICBjb25zdCBNSVNUUkFMXzdCX0lOU1RSVUNUMl9NT0RFTF9JRCA9XG4gICAgICAgIFwibWlzdHJhbGFpL01pc3RyYWwtN0ItSW5zdHJ1Y3QtdjAuMlwiO1xuICAgICAgY29uc3QgTUlTVFJBTF83Ql9JTlNUUlVDVDJfRU5EUE9JTlRfTkFNRSA9XG4gICAgICAgIE1JU1RSQUxfN0JfSU5TVFJVQ1QyX01PREVMX0lELnNwbGl0KFwiL1wiKS5qb2luKFwiLVwiKS5zcGxpdChcIi5cIikuam9pbihcIi1cIik7XG5cbiAgICAgIGNvbnN0IG1pc3RyYWw3Qkluc3RydWN0MiA9IG5ldyBIdWdnaW5nRmFjZVNhZ2VNYWtlckVuZHBvaW50KFxuICAgICAgICB0aGlzLFxuICAgICAgICBcIk1pc3RyYWw3Qkluc3RydWN0MlwiLFxuICAgICAgICB7XG4gICAgICAgICAgbW9kZWxJZDogTUlTVFJBTF83Ql9JTlNUUlVDVDJfTU9ERUxfSUQsXG4gICAgICAgICAgdnBjQ29uZmlnOiB7XG4gICAgICAgICAgICBzZWN1cml0eUdyb3VwSWRzOiBbcHJvcHMuc2hhcmVkLnZwYy52cGNEZWZhdWx0U2VjdXJpdHlHcm91cF0sXG4gICAgICAgICAgICBzdWJuZXRzOiBwcm9wcy5zaGFyZWQudnBjLnByaXZhdGVTdWJuZXRzLm1hcChcbiAgICAgICAgICAgICAgKHN1Ym5ldCkgPT4gc3VibmV0LnN1Ym5ldElkXG4gICAgICAgICAgICApLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgY29udGFpbmVyOiBEZWVwTGVhcm5pbmdDb250YWluZXJJbWFnZS5mcm9tRGVlcExlYXJuaW5nQ29udGFpbmVySW1hZ2UoXG4gICAgICAgICAgICBcImh1Z2dpbmdmYWNlLXB5dG9yY2gtdGdpLWluZmVyZW5jZVwiLFxuICAgICAgICAgICAgXCIyLjEuMS10Z2kxLjMuMy1ncHUtcHkzMTAtY3UxMjEtdWJ1bnR1MjAuMDRcIlxuICAgICAgICAgICksXG4gICAgICAgICAgaW5zdGFuY2VUeXBlOiBTYWdlTWFrZXJJbnN0YW5jZVR5cGUuTUxfRzVfMlhMQVJHRSxcbiAgICAgICAgICBzdGFydHVwSGVhbHRoQ2hlY2tUaW1lb3V0SW5TZWNvbmRzOiAzMDAsXG4gICAgICAgICAgZW5kcG9pbnROYW1lOiBNSVNUUkFMXzdCX0lOU1RSVUNUMl9FTkRQT0lOVF9OQU1FLFxuICAgICAgICAgIGVudmlyb25tZW50OiB7XG4gICAgICAgICAgICBTTV9OVU1fR1BVUzogSlNPTi5zdHJpbmdpZnkoMSksXG4gICAgICAgICAgICBNQVhfSU5QVVRfTEVOR1RIOiBKU09OLnN0cmluZ2lmeSgyMDQ4KSxcbiAgICAgICAgICAgIE1BWF9UT1RBTF9UT0tFTlM6IEpTT04uc3RyaW5naWZ5KDQwOTYpLFxuICAgICAgICAgICAgTUFYX0NPTkNVUlJFTlRfUkVRVUVTVFM6IEpTT04uc3RyaW5naWZ5KDQpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIHRoaXMuc3VwcHJlc3NDZGtOYWdXYXJuaW5nRm9yRW5kcG9pbnRSb2xlKG1pc3RyYWw3Qkluc3RydWN0Mi5yb2xlKTtcblxuICAgICAgbW9kZWxzLnB1c2goe1xuICAgICAgICBuYW1lOiBNSVNUUkFMXzdCX0lOU1RSVUNUMl9FTkRQT0lOVF9OQU1FISxcbiAgICAgICAgZW5kcG9pbnQ6IG1pc3RyYWw3Qkluc3RydWN0Mi5jZm5FbmRwb2ludCxcbiAgICAgICAgcmVzcG9uc2VTdHJlYW1pbmdTdXBwb3J0ZWQ6IGZhbHNlLFxuICAgICAgICBpbnB1dE1vZGFsaXRpZXM6IFtNb2RhbGl0eS5UZXh0XSxcbiAgICAgICAgb3V0cHV0TW9kYWxpdGllczogW01vZGFsaXR5LlRleHRdLFxuICAgICAgICBpbnRlcmZhY2U6IE1vZGVsSW50ZXJmYWNlLkxhbmdDaGFpbixcbiAgICAgICAgcmFnU3VwcG9ydGVkOiB0cnVlLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgcHJvcHMuY29uZmlnLmxsbXM/LnNhZ2VtYWtlci5pbmNsdWRlcyhcbiAgICAgICAgU3VwcG9ydGVkU2FnZU1ha2VyTW9kZWxzLk1peHRyYWxfOHg3Yl9JbnN0cnVjdFxuICAgICAgKVxuICAgICkge1xuICAgICAgY29uc3QgTUlTVFJBTF84eDdCX01PREVMX0lEID0gXCJtaXN0cmFsYWkvTWl4dHJhbC04eDdCLUluc3RydWN0LXYwLjFcIjtcbiAgICAgIGNvbnN0IE1JU1RSQUxfOHg3Ql9JTlNUUlVDVDJfRU5EUE9JTlRfTkFNRSA9IE1JU1RSQUxfOHg3Ql9NT0RFTF9JRC5zcGxpdChcbiAgICAgICAgXCIvXCJcbiAgICAgIClcbiAgICAgICAgLmpvaW4oXCItXCIpXG4gICAgICAgIC5zcGxpdChcIi5cIilcbiAgICAgICAgLmpvaW4oXCItXCIpO1xuXG4gICAgICBjb25zdCBtaXN0cmFsOHg3QiA9IG5ldyBIdWdnaW5nRmFjZVNhZ2VNYWtlckVuZHBvaW50KFxuICAgICAgICB0aGlzLFxuICAgICAgICBcIk1peHRyYWw4eDdiaW5zdHJ1Y3RcIixcbiAgICAgICAge1xuICAgICAgICAgIG1vZGVsSWQ6IE1JU1RSQUxfOHg3Ql9NT0RFTF9JRCxcbiAgICAgICAgICB2cGNDb25maWc6IHtcbiAgICAgICAgICAgIHNlY3VyaXR5R3JvdXBJZHM6IFtwcm9wcy5zaGFyZWQudnBjLnZwY0RlZmF1bHRTZWN1cml0eUdyb3VwXSxcbiAgICAgICAgICAgIHN1Ym5ldHM6IHByb3BzLnNoYXJlZC52cGMucHJpdmF0ZVN1Ym5ldHMubWFwKFxuICAgICAgICAgICAgICAoc3VibmV0KSA9PiBzdWJuZXQuc3VibmV0SWRcbiAgICAgICAgICAgICksXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjb250YWluZXI6IERlZXBMZWFybmluZ0NvbnRhaW5lckltYWdlLmZyb21EZWVwTGVhcm5pbmdDb250YWluZXJJbWFnZShcbiAgICAgICAgICAgIFwiaHVnZ2luZ2ZhY2UtcHl0b3JjaC10Z2ktaW5mZXJlbmNlXCIsXG4gICAgICAgICAgICBcIjIuMS4xLXRnaTEuMy4zLWdwdS1weTMxMC1jdTEyMS11YnVudHUyMC4wNFwiXG4gICAgICAgICAgKSxcbiAgICAgICAgICBpbnN0YW5jZVR5cGU6IFNhZ2VNYWtlckluc3RhbmNlVHlwZS5NTF9HNV80OFhMQVJHRSxcbiAgICAgICAgICBzdGFydHVwSGVhbHRoQ2hlY2tUaW1lb3V0SW5TZWNvbmRzOiAzMDAsXG4gICAgICAgICAgZW5kcG9pbnROYW1lOiBNSVNUUkFMXzh4N0JfSU5TVFJVQ1QyX0VORFBPSU5UX05BTUUsXG4gICAgICAgICAgZW52aXJvbm1lbnQ6IHtcbiAgICAgICAgICAgIFNNX05VTV9HUFVTOiBKU09OLnN0cmluZ2lmeSg4KSxcbiAgICAgICAgICAgIE1BWF9JTlBVVF9MRU5HVEg6IEpTT04uc3RyaW5naWZ5KDI0NTc2KSxcbiAgICAgICAgICAgIE1BWF9UT1RBTF9UT0tFTlM6IEpTT04uc3RyaW5naWZ5KDMyNzY4KSxcbiAgICAgICAgICAgIE1BWF9CQVRDSF9QUkVGSUxMX1RPS0VOUzogSlNPTi5zdHJpbmdpZnkoMjQ1NzYpLFxuICAgICAgICAgICAgTUFYX0NPTkNVUlJFTlRfUkVRVUVTVFM6IEpTT04uc3RyaW5naWZ5KDQpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIHRoaXMuc3VwcHJlc3NDZGtOYWdXYXJuaW5nRm9yRW5kcG9pbnRSb2xlKG1pc3RyYWw4eDdCLnJvbGUpO1xuXG4gICAgICBtb2RlbHMucHVzaCh7XG4gICAgICAgIG5hbWU6IE1JU1RSQUxfOHg3Ql9JTlNUUlVDVDJfRU5EUE9JTlRfTkFNRSEsXG4gICAgICAgIGVuZHBvaW50OiBtaXN0cmFsOHg3Qi5jZm5FbmRwb2ludCxcbiAgICAgICAgcmVzcG9uc2VTdHJlYW1pbmdTdXBwb3J0ZWQ6IGZhbHNlLFxuICAgICAgICBpbnB1dE1vZGFsaXRpZXM6IFtNb2RhbGl0eS5UZXh0XSxcbiAgICAgICAgb3V0cHV0TW9kYWxpdGllczogW01vZGFsaXR5LlRleHRdLFxuICAgICAgICBpbnRlcmZhY2U6IE1vZGVsSW50ZXJmYWNlLkxhbmdDaGFpbixcbiAgICAgICAgcmFnU3VwcG9ydGVkOiB0cnVlLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgcHJvcHMuY29uZmlnLmxsbXM/LnNhZ2VtYWtlci5pbmNsdWRlcyhcbiAgICAgICAgU3VwcG9ydGVkU2FnZU1ha2VyTW9kZWxzLkxsYW1hMl8xM2JfQ2hhdFxuICAgICAgKVxuICAgICkge1xuICAgICAgY29uc3QgTExBTUEyXzEzQl9DSEFUX0VORFBPSU5UX05BTUUgPSBcIm1ldGEtTExhbWEyLTEzYi1jaGF0XCI7XG5cbiAgICAgIGNvbnN0IGxsYW1hMl8xM2JfY2hhdCA9IG5ldyBKdW1wU3RhcnRTYWdlTWFrZXJFbmRwb2ludChcbiAgICAgICAgdGhpcyxcbiAgICAgICAgXCJMTGFtYVYyXzEzQl9DaGF0XCIsXG4gICAgICAgIHtcbiAgICAgICAgICBtb2RlbDogSnVtcFN0YXJ0TW9kZWwuTUVUQV9URVhUR0VORVJBVElPTl9MTEFNQV8yXzEzQl9GXzJfMF8yLFxuICAgICAgICAgIGluc3RhbmNlVHlwZTogU2FnZU1ha2VySW5zdGFuY2VUeXBlLk1MX0c1XzEyWExBUkdFLFxuICAgICAgICAgIHZwY0NvbmZpZzoge1xuICAgICAgICAgICAgc2VjdXJpdHlHcm91cElkczogW3Byb3BzLnNoYXJlZC52cGMudnBjRGVmYXVsdFNlY3VyaXR5R3JvdXBdLFxuICAgICAgICAgICAgc3VibmV0czogcHJvcHMuc2hhcmVkLnZwYy5wcml2YXRlU3VibmV0cy5tYXAoXG4gICAgICAgICAgICAgIChzdWJuZXQpID0+IHN1Ym5ldC5zdWJuZXRJZFxuICAgICAgICAgICAgKSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVuZHBvaW50TmFtZTogTExBTUEyXzEzQl9DSEFUX0VORFBPSU5UX05BTUUsXG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIHRoaXMuc3VwcHJlc3NDZGtOYWdXYXJuaW5nRm9yRW5kcG9pbnRSb2xlKGxsYW1hMl8xM2JfY2hhdC5yb2xlKTtcblxuICAgICAgbW9kZWxzLnB1c2goe1xuICAgICAgICBuYW1lOiBMTEFNQTJfMTNCX0NIQVRfRU5EUE9JTlRfTkFNRSxcbiAgICAgICAgZW5kcG9pbnQ6IGxsYW1hMl8xM2JfY2hhdC5jZm5FbmRwb2ludCxcbiAgICAgICAgcmVzcG9uc2VTdHJlYW1pbmdTdXBwb3J0ZWQ6IGZhbHNlLFxuICAgICAgICBpbnB1dE1vZGFsaXRpZXM6IFtNb2RhbGl0eS5UZXh0XSxcbiAgICAgICAgb3V0cHV0TW9kYWxpdGllczogW01vZGFsaXR5LlRleHRdLFxuICAgICAgICBpbnRlcmZhY2U6IE1vZGVsSW50ZXJmYWNlLkxhbmdDaGFpbixcbiAgICAgICAgcmFnU3VwcG9ydGVkOiB0cnVlLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgcHJvcHMuY29uZmlnLmxsbXM/LnNhZ2VtYWtlci5pbmNsdWRlcyhTdXBwb3J0ZWRTYWdlTWFrZXJNb2RlbHMuSWRlZmljc185YilcbiAgICApIHtcbiAgICAgIGNvbnN0IElERUZJQ1NfOUJfTU9ERUxfSUQgPSBcIkh1Z2dpbmdGYWNlTTQvaWRlZmljcy05Yi1pbnN0cnVjdFwiO1xuICAgICAgY29uc3QgSURFRklDU185Ql9FTkRQT0lOVF9OQU1FID0gSURFRklDU185Ql9NT0RFTF9JRC5zcGxpdChcIi9cIilcbiAgICAgICAgLmpvaW4oXCItXCIpXG4gICAgICAgIC5zcGxpdChcIi5cIilcbiAgICAgICAgLmpvaW4oXCItXCIpO1xuXG4gICAgICBjb25zdCBpZGVmaWNzOWIgPSBuZXcgSHVnZ2luZ0ZhY2VTYWdlTWFrZXJFbmRwb2ludCh0aGlzLCBcIklERUZJQ1M5QlwiLCB7XG4gICAgICAgIG1vZGVsSWQ6IElERUZJQ1NfOUJfTU9ERUxfSUQsXG4gICAgICAgIHZwY0NvbmZpZzoge1xuICAgICAgICAgIHNlY3VyaXR5R3JvdXBJZHM6IFtwcm9wcy5zaGFyZWQudnBjLnZwY0RlZmF1bHRTZWN1cml0eUdyb3VwXSxcbiAgICAgICAgICBzdWJuZXRzOiBwcm9wcy5zaGFyZWQudnBjLnByaXZhdGVTdWJuZXRzLm1hcChcbiAgICAgICAgICAgIChzdWJuZXQpID0+IHN1Ym5ldC5zdWJuZXRJZFxuICAgICAgICAgICksXG4gICAgICAgIH0sXG4gICAgICAgIGNvbnRhaW5lcjpcbiAgICAgICAgICBEZWVwTGVhcm5pbmdDb250YWluZXJJbWFnZS5IVUdHSU5HRkFDRV9QWVRPUkNIX1RHSV9JTkZFUkVOQ0VfMl8wXzFfVEdJMV8xXzBfR1BVX1BZMzlfQ1UxMThfVUJVTlRVMjBfMDQsXG4gICAgICAgIGluc3RhbmNlVHlwZTogU2FnZU1ha2VySW5zdGFuY2VUeXBlLk1MX0c1XzEyWExBUkdFLFxuICAgICAgICBzdGFydHVwSGVhbHRoQ2hlY2tUaW1lb3V0SW5TZWNvbmRzOiAzMDAsXG4gICAgICAgIGVuZHBvaW50TmFtZTogSURFRklDU185Ql9FTkRQT0lOVF9OQU1FLFxuICAgICAgICBlbnZpcm9ubWVudDoge1xuICAgICAgICAgIFNNX05VTV9HUFVTOiBKU09OLnN0cmluZ2lmeSg0KSxcbiAgICAgICAgICBNQVhfSU5QVVRfTEVOR1RIOiBKU09OLnN0cmluZ2lmeSgxMDI0KSxcbiAgICAgICAgICBNQVhfVE9UQUxfVE9LRU5TOiBKU09OLnN0cmluZ2lmeSgyMDQ4KSxcbiAgICAgICAgICBNQVhfQkFUQ0hfVE9UQUxfVE9LRU5TOiBKU09OLnN0cmluZ2lmeSg4MTkyKSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnN1cHByZXNzQ2RrTmFnV2FybmluZ0ZvckVuZHBvaW50Um9sZShpZGVmaWNzOWIucm9sZSk7XG5cbiAgICAgIG1vZGVscy5wdXNoKHtcbiAgICAgICAgbmFtZTogSURFRklDU185Ql9FTkRQT0lOVF9OQU1FISxcbiAgICAgICAgZW5kcG9pbnQ6IGlkZWZpY3M5Yi5jZm5FbmRwb2ludCxcbiAgICAgICAgcmVzcG9uc2VTdHJlYW1pbmdTdXBwb3J0ZWQ6IGZhbHNlLFxuICAgICAgICBpbnB1dE1vZGFsaXRpZXM6IFtNb2RhbGl0eS5UZXh0LCBNb2RhbGl0eS5JbWFnZV0sXG4gICAgICAgIG91dHB1dE1vZGFsaXRpZXM6IFtNb2RhbGl0eS5UZXh0XSxcbiAgICAgICAgaW50ZXJmYWNlOiBNb2RlbEludGVyZmFjZS5NdWx0aU1vZGFsLFxuICAgICAgICByYWdTdXBwb3J0ZWQ6IGZhbHNlLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgcHJvcHMuY29uZmlnLmxsbXM/LnNhZ2VtYWtlci5pbmNsdWRlcyhcbiAgICAgICAgU3VwcG9ydGVkU2FnZU1ha2VyTW9kZWxzLklkZWZpY3NfODBiXG4gICAgICApXG4gICAgKSB7XG4gICAgICBjb25zdCBJREVGSUNTXzgwQl9NT0RFTF9JRCA9IFwiSHVnZ2luZ0ZhY2VNNC9pZGVmaWNzLTgwYi1pbnN0cnVjdFwiO1xuICAgICAgY29uc3QgSURFRklDU184MEJfRU5EUE9JTlRfTkFNRSA9IElERUZJQ1NfODBCX01PREVMX0lELnNwbGl0KFwiL1wiKVxuICAgICAgICAuam9pbihcIi1cIilcbiAgICAgICAgLnNwbGl0KFwiLlwiKVxuICAgICAgICAuam9pbihcIi1cIik7XG5cbiAgICAgIGNvbnN0IGlkZWZpY3M4MGIgPSBuZXcgSHVnZ2luZ0ZhY2VTYWdlTWFrZXJFbmRwb2ludCh0aGlzLCBcIklERUZJQ1M4MEJcIiwge1xuICAgICAgICBtb2RlbElkOiBJREVGSUNTXzgwQl9NT0RFTF9JRCxcbiAgICAgICAgdnBjQ29uZmlnOiB7XG4gICAgICAgICAgc2VjdXJpdHlHcm91cElkczogW3Byb3BzLnNoYXJlZC52cGMudnBjRGVmYXVsdFNlY3VyaXR5R3JvdXBdLFxuICAgICAgICAgIHN1Ym5ldHM6IHByb3BzLnNoYXJlZC52cGMucHJpdmF0ZVN1Ym5ldHMubWFwKFxuICAgICAgICAgICAgKHN1Ym5ldCkgPT4gc3VibmV0LnN1Ym5ldElkXG4gICAgICAgICAgKSxcbiAgICAgICAgfSxcbiAgICAgICAgY29udGFpbmVyOlxuICAgICAgICAgIERlZXBMZWFybmluZ0NvbnRhaW5lckltYWdlLkhVR0dJTkdGQUNFX1BZVE9SQ0hfVEdJX0lORkVSRU5DRV8yXzBfMV9UR0kxXzFfMF9HUFVfUFkzOV9DVTExOF9VQlVOVFUyMF8wNCxcbiAgICAgICAgaW5zdGFuY2VUeXBlOiBTYWdlTWFrZXJJbnN0YW5jZVR5cGUuTUxfRzVfNDhYTEFSR0UsXG4gICAgICAgIHN0YXJ0dXBIZWFsdGhDaGVja1RpbWVvdXRJblNlY29uZHM6IDYwMCxcbiAgICAgICAgZW5kcG9pbnROYW1lOiBJREVGSUNTXzgwQl9FTkRQT0lOVF9OQU1FLFxuICAgICAgICBlbnZpcm9ubWVudDoge1xuICAgICAgICAgIFNNX05VTV9HUFVTOiBKU09OLnN0cmluZ2lmeSg4KSxcbiAgICAgICAgICBNQVhfSU5QVVRfTEVOR1RIOiBKU09OLnN0cmluZ2lmeSgxMDI0KSxcbiAgICAgICAgICBNQVhfVE9UQUxfVE9LRU5TOiBKU09OLnN0cmluZ2lmeSgyMDQ4KSxcbiAgICAgICAgICBNQVhfQkFUQ0hfVE9UQUxfVE9LRU5TOiBKU09OLnN0cmluZ2lmeSg4MTkyKSxcbiAgICAgICAgICAvLyBxdWFudGl6YXRpb24gcmVxdWlyZWQgdG8gd29yayB3aXRoIG1sLmc1LjQ4eGxhcmdlXG4gICAgICAgICAgLy8gY29tbWVudCBpZiBkZXBsb3lpbmcgd2l0aCBtbC5wNGQgb3IgbWwucDRlIGluc3RhbmNlc1xuICAgICAgICAgIEhGX01PREVMX1FVQU5USVpFOiBcImJpdHNhbmRieXRlc1wiLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuc3VwcHJlc3NDZGtOYWdXYXJuaW5nRm9yRW5kcG9pbnRSb2xlKGlkZWZpY3M4MGIucm9sZSk7XG5cbiAgICAgIG1vZGVscy5wdXNoKHtcbiAgICAgICAgbmFtZTogSURFRklDU184MEJfRU5EUE9JTlRfTkFNRSEsXG4gICAgICAgIGVuZHBvaW50OiBpZGVmaWNzODBiLmNmbkVuZHBvaW50LFxuICAgICAgICByZXNwb25zZVN0cmVhbWluZ1N1cHBvcnRlZDogZmFsc2UsXG4gICAgICAgIGlucHV0TW9kYWxpdGllczogW01vZGFsaXR5LlRleHQsIE1vZGFsaXR5LkltYWdlXSxcbiAgICAgICAgb3V0cHV0TW9kYWxpdGllczogW01vZGFsaXR5LlRleHRdLFxuICAgICAgICBpbnRlcmZhY2U6IE1vZGVsSW50ZXJmYWNlLk11bHRpTW9kYWwsXG4gICAgICAgIHJhZ1N1cHBvcnRlZDogZmFsc2UsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBtb2RlbHNQYXJhbWV0ZXIgPSBuZXcgc3NtLlN0cmluZ1BhcmFtZXRlcih0aGlzLCBcIk1vZGVsc1BhcmFtZXRlclwiLCB7XG4gICAgICBzdHJpbmdWYWx1ZTogSlNPTi5zdHJpbmdpZnkoXG4gICAgICAgIG1vZGVscy5tYXAoKG1vZGVsKSA9PiAoe1xuICAgICAgICAgIG5hbWU6IG1vZGVsLm5hbWUsXG4gICAgICAgICAgZW5kcG9pbnQ6IG1vZGVsLmVuZHBvaW50LmVuZHBvaW50TmFtZSxcbiAgICAgICAgICByZXNwb25zZVN0cmVhbWluZ1N1cHBvcnRlZDogbW9kZWwucmVzcG9uc2VTdHJlYW1pbmdTdXBwb3J0ZWQsXG4gICAgICAgICAgaW5wdXRNb2RhbGl0aWVzOiBtb2RlbC5pbnB1dE1vZGFsaXRpZXMsXG4gICAgICAgICAgb3V0cHV0TW9kYWxpdGllczogbW9kZWwub3V0cHV0TW9kYWxpdGllcyxcbiAgICAgICAgICBpbnRlcmZhY2U6IG1vZGVsLmludGVyZmFjZSxcbiAgICAgICAgICByYWdTdXBwb3J0ZWQ6IG1vZGVsLnJhZ1N1cHBvcnRlZCxcbiAgICAgICAgfSkpXG4gICAgICApLFxuICAgIH0pO1xuXG4gICAgdGhpcy5tb2RlbHMgPSBtb2RlbHM7XG4gICAgdGhpcy5tb2RlbHNQYXJhbWV0ZXIgPSBtb2RlbHNQYXJhbWV0ZXI7XG4gICAgXG4gICAgaWYgKG1vZGVscy5sZW5ndGggPiAwICYmIHByb3BzLmNvbmZpZy5sbG1zPy5zYWdlbWFrZXJTY2hlZHVsZT8uZW5hYmxlZCkge1xuXG4gICAgICBsZXQgc2NoZWR1bGVyUm9sZTogaWFtLlJvbGUgPSBuZXcgaWFtLlJvbGUodGhpcywgJ1NjaGVkdWxlclJvbGUnLCB7XG4gICAgICAgIGFzc3VtZWRCeTogbmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCdzY2hlZHVsZXIuYW1hem9uYXdzLmNvbScpLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1JvbGUgZm9yIFNjaGVkdWxlciB0byBpbnRlcmFjdCB3aXRoIFNhZ2VNYWtlcicsXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgc2NoZWR1bGVyUm9sZS5hZGRNYW5hZ2VkUG9saWN5KGlhbS5NYW5hZ2VkUG9saWN5LmZyb21Bd3NNYW5hZ2VkUG9saWN5TmFtZSgnQW1hem9uU2FnZU1ha2VyRnVsbEFjY2VzcycpKTtcbiAgICAgIHRoaXMuc3VwcHJlc3NDZGtOYWdXYXJuaW5nRm9yRW5kcG9pbnRSb2xlKHNjaGVkdWxlclJvbGUpO1xuXG4gICAgICBtb2RlbHMuZm9yRWFjaCgobW9kZWwpID0+IHtcbiAgICAgICAgICBjcmVhdGVTdGFydFNjaGVkdWxlKHRoaXMsIGlkLCBtb2RlbC5lbmRwb2ludCwgc2NoZWR1bGVyUm9sZSwgcHJvcHMuY29uZmlnKTtcbiAgICAgICAgICBjcmVhdGVTdG9wU2NoZWR1bGUodGhpcywgaWQsIG1vZGVsLmVuZHBvaW50LCBzY2hlZHVsZXJSb2xlLCBwcm9wcy5jb25maWcpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzdXBwcmVzc0Nka05hZ1dhcm5pbmdGb3JFbmRwb2ludFJvbGUocm9sZTogaWFtLlJvbGUpIHtcbiAgICBOYWdTdXBwcmVzc2lvbnMuYWRkUmVzb3VyY2VTdXBwcmVzc2lvbnMoXG4gICAgICByb2xlLFxuICAgICAgW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6IFwiQXdzU29sdXRpb25zLUlBTTRcIixcbiAgICAgICAgICByZWFzb246XG4gICAgICAgICAgICBcIkdpdmVzIHVzZXIgYWJpbGl0eSB0byBkZXBsb3kgYW5kIGRlbGV0ZSBlbmRwb2ludHMgZnJvbSB0aGUgVUkuXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogXCJBd3NTb2x1dGlvbnMtSUFNNVwiLFxuICAgICAgICAgIHJlYXNvbjpcbiAgICAgICAgICAgIFwiR2l2ZXMgdXNlciBhYmlsaXR5IHRvIGRlcGxveSBhbmQgZGVsZXRlIGVuZHBvaW50cyBmcm9tIHRoZSBVSS5cIixcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICB0cnVlXG4gICAgKTtcbiAgfVxufVxuIl19